<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>The Rascal Language</title><meta content="DocBook XSL Stylesheets V1.75.2" name="generator"><link rel="home" href="index.html" title="Chapter&nbsp;1.&nbsp;EASY Meta-Programming with Rascal"><link rel="up" href="index.html" title="Chapter&nbsp;1.&nbsp;EASY Meta-Programming with Rascal"><link rel="prev" href="ch01s05.html" title="Larger Examples"><link rel="next" href="ch01s07.html" title="Built-in Operators and Library Functions"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">The Rascal Language</th></tr><tr><td align="left" width="20%"><a accesskey="p" href="ch01s05.html">Prev</a>&nbsp;</td><th align="center" width="60%">&nbsp;</th><td align="right" width="20%">&nbsp;<a accesskey="n" href="ch01s07.html">Next</a></td></tr></table><hr></div><div class="section" title="The Rascal Language"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section.rascal-language"></a>The Rascal Language</h2></div></div></div>
    

    <p>A Rascal program consists of one or more modules. Each module may
    import other modules and declare data types, variables, functions or
    rewrite rules. We now describe the basic ingredients of Rascal in more
    detail:</p>

    <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
        <p>Types and values, see <a class="xref" href="ch01s06.html#section.types-and-values" title="Types and Values">the section called &ldquo;Types and Values&rdquo;</a>.</p>
      </li><li class="listitem">
        <p>Declarations, see <a class="xref" href="ch01s06.html#section.declarations" title="Declarations">the section called &ldquo;Declarations&rdquo;</a>.</p>
      </li><li class="listitem">
        <p>Expressions, see <a class="xref" href="ch01s06.html#section.expressions" title="Expressions">the section called &ldquo;Expressions&rdquo;</a>.</p>
      </li><li class="listitem">
        <p>Statements, see <a class="xref" href="ch01s06.html#section.statements" title="Statements">the section called &ldquo;Statements&rdquo;</a>.</p>
      </li></ul></div>

    <div class="section" title="Types and Values"><div class="titlepage"><div><div><h3 class="title"><a name="section.types-and-values"></a>Types and Values</h3></div></div></div>
      

      <div class="section" title="Elementary Types and Values"><div class="titlepage"><div><div><h4 class="title"><a name="section.elementary-types"></a>Elementary Types and Values</h4></div></div></div>
        

        <p title="Void">
          <b>Void.&nbsp;</b>

          Void stands for <span class="emphasis"><em>nothing</em></span> and is
          represented by the type <code class="literal">void</code>. It is a type
          without any values.
        </p>

        <p title="Value">
          <b>Value.&nbsp;</b>

          Value stands for all possible Rascal values and is represented
          by the type <code class="literal">value</code>. This type is a container for
          all other types and does not have any values itself.
        </p>

        <p title="Boolean">
          <b>Boolean.&nbsp;</b>

          The Booleans are represented by the type
          <code class="literal">bool</code> which has two values:
          <code class="literal">true</code> and <code class="literal">false</code>.
        </p>

        <p title="Integer">
          <b>Integer.&nbsp;</b>

          The integer values are represented by the type
          <code class="literal">int</code> and are written as usual, e.g.,
          <code class="literal">0</code>, <code class="literal">1</code>, or
          <code class="literal">123</code>. They can be arbitrarily large.
        </p>

        <p title="Real">
          <b>Real.&nbsp;</b>

          The real values are represented by the type
          <code class="literal">real</code> and are written as usual, e.g.,
          <code class="literal">1.5</code>, or <code class="literal">3.14e-123.</code> They can
          have arbitrary size and precision.
        </p>

        <p title="String">
          <b>String.&nbsp;</b>

          The string values are represented by the type
          <code class="literal">str</code> and consist of character sequences surrounded
          by double quotes. e.g., <code class="literal">"a"</code> or
          <code class="literal">"a\nlong\tstring"</code>.
        </p>

        <p>String literals permit <span class="emphasis"><em>interpolation</em></span> of
        variable values: when
        <code class="literal">&lt;<em class="replaceable"><code>X</code></em>&gt;</code> occurs inside
        a string literal, the value of the variable
        <em class="replaceable"><code>X</code></em> is converted to a string that replaces
        &lt;<em class="replaceable"><code>X</code></em>&gt;. As a consequence, the character
        <code class="literal">&lt; </code>has to be escaped as<code class="literal">\&lt;</code>
        in string literals.</p>

        <p title="Location">
          <b>Location.&nbsp;</b>

          Location values are represented by the type
          <code class="literal">loc</code> and serve as text coordinates in a specific
          source file. It is very handy to associate a source code location
          which extracted facts.
        </p>

        <p>Source locations have the following syntax:</p>

        <pre class="programlisting">loc(<em class="replaceable"><code>Url</code></em>?offset=<em class="replaceable"><code>O</code></em>&amp;length=<em class="replaceable"><code>L</code></em>&amp;begin=<em class="replaceable"><code>BL</code></em>,<em class="replaceable"><code>BC</code></em>&amp;end=<em class="replaceable"><code>EL</code></em>,<em class="replaceable"><code>EC)</code></em></pre><p>where:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><em class="replaceable"><code>Url</code></em> is an arbitrary URL.</p>
          </li><li class="listitem">
            <p><em class="replaceable"><code>O</code></em> and
            <em class="replaceable"><code>L</code></em> are integer expressions giving the
            offset of this location to the begin of file, respectively , its
            length.</p>
          </li><li class="listitem">
            <p><em class="replaceable"><code>BL</code></em> and
            <em class="replaceable"><code>BC</code></em> are integers expressions giving the
            begin line and begin column.</p>
          </li><li class="listitem">
            <p><em class="replaceable"><code>EL</code></em> and
            <em class="replaceable"><code>EC</code></em> are integers expressions giving the
            end line and end column.</p>
          </li></ul></div>

        <p>Locations should <span class="emphasis"><em>always</em></span> be generated
        automatically but for the curious here is an example: </p><pre class="programlisting">loc(file:///home/paulk/pico.trm?offset=0&amp;length=1&amp;begin=2,3&amp;end=4,5)</pre>

        <p>The elements of a location value can be accessed and modified
        using the standard mechanism of field selection and field assignment.
        The corresponding field names are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="literal">url</code></p>
          </li><li class="listitem">
            <p><code class="literal">offset</code></p>
          </li><li class="listitem">
            <p><code class="literal">length</code></p>
          </li><li class="listitem">
            <p><code class="literal">beginLine</code>,
            <code class="literal">beginColumn</code></p>
          </li><li class="listitem">
            <p><code class="literal">endLine</code>,
            <code class="literal">endColumn</code>.</p>
          </li></ul></div>
      </div>

      <div class="section" title="List, Set, Map, Tuple, and Relation"><div class="titlepage"><div><div><h4 class="title"><a name="N21306"></a>List, Set, Map, Tuple, and Relation</h4></div></div></div>
        

        <p title="List">
          <b>List.&nbsp;</b>

          A list is an ordered sequence of values and has the following
          properties:
        </p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>All elements have the same static type.</p>
          </li><li class="listitem">
            <p>The order of the elements matters.</p>
          </li><li class="listitem">
            <p>The list may contain the same element more than once.</p>
          </li></ul></div>

        <p>Lists are represented by the type
        <code class="literal">list[</code><em class="replaceable"><code>T</code></em><code class="literal">]</code>,
        where <em class="replaceable"><code>T</code></em> is an arbitrary type. Examples are
        <code class="literal">list[int]</code>, <code class="literal">list[tuple[int,int]]</code>
        and <code class="literal">list[list[str]]</code>. Lists are denoted by a list of
        elements, separated by comma's and enclosed in bracket as in
        <code class="literal">[</code><em class="replaceable"><code>E</code></em><sub>1</sub><code class="literal">,</code>
        <em class="replaceable"><code>E</code></em><sub>2</sub><code class="literal">,
        ...,</code>
        <em class="replaceable"><code>E</code></em><sub><em class="replaceable"><code>n</code></em></sub><code class="literal">]</code>,
        where the
        <em class="replaceable"><code>E</code></em><sub><em class="replaceable"><code>n</code></em></sub>
        (1 &lt;= <em class="replaceable"><code>i</code></em>&lt;=
        <em class="replaceable"><code>n</code></em>) are expressions that yield the desired
        element type. For example,</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="literal">[1, 2, 3]</code> is of type
            <code class="literal">list[int]</code>,</p>
          </li><li class="listitem">
            <p><code class="literal">{&lt;1,10&gt;, &lt;2,20&gt;,
            &lt;3,30&gt;}</code> is of type
            <code class="literal">set[tuple[int,int]]</code>,</p>
          </li><li class="listitem">
            <p><code class="literal">[1, "b", 3]</code> is of type
            <code class="literal">list[value]</code>,</p>
          </li><li class="listitem">
            <p><code class="literal">[&lt;"a",10&gt;, &lt;"b",20&gt;,
            &lt;"c",30&gt;]</code> is of type
            <code class="literal">list[tuple[str,int]]</code>, and</p>
          </li><li class="listitem">
            <p><code class="literal">[["a", "b"], ["c", "d", "e"]]</code> is of type
            <code class="literal">list[list[str]]</code>.</p>
          </li></ul></div>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            <p><code class="literal">[1, 2, 3]</code> and <code class="literal">[3, 2,
            1]</code> are different lists.</p>
          </div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            <p><code class="literal">[1, 2, 3]</code> and <code class="literal">[1, 2, 3,
            1]</code> are also different lists.</p>
          </div>

        <p>When variables of type list occur inside a list, their elements
        are automatically <span class="emphasis"><em>spliced</em></span> into the surrounding
        list. This can be prevented by surrounding them with extra [ and ]
        brackets.</p><pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>L = [1, 2, 3];</code></strong>
<code class="computeroutput">list[int]: [1,2,3]</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>[10, L, 20];</code></strong>
<code class="computeroutput">list[int]: [10, 1, 2, 3, 20]</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>[10, [L], 20];</code></strong>
<code class="computeroutput">list[value]: [10, [1,2,3], 20]</code></pre>

        <p title="Range">
          <b>Range.&nbsp;</b>

          For lists of integers, a special shorthand exists to describe
          ranges of integers:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p><code class="literal">[<em class="replaceable"><code>F</code></em> ..
                <em class="replaceable"><code>L</code></em>]</code> ranges from first
                element <em class="replaceable"><code>F</code></em> up to (and including)
                last element <em class="replaceable"><code>L</code></em> with increments of
                1.</p>
              </li><li class="listitem">
                <p><code class="literal">[<em class="replaceable"><code>F</code></em>,<em class="replaceable"><code>S</code></em>,..<em class="replaceable"><code>
                E</code></em>]</code>, ranges from first element
                <em class="replaceable"><code>F</code></em>, second element S up to (and
                including) last element <em class="replaceable"><code>L</code></em> with
                increments of <code class="literal">S</code> -
                <em class="replaceable"><code>F</code></em>.</p>
              </li></ul></div><p title="Range">
        </p>

        <p title="Set">
          <b>Set.&nbsp;</b>

          A set is an unordered sequence of values and has the following
          properties:
        </p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>All elements have the same static type.</p>
          </li><li class="listitem">
            <p>The order of the elements does not matter.</p>
          </li><li class="listitem">
            <p>A set contains an element only once. In other words,
            duplicate elements are eliminated and no matter how many times an
            element is added to a set, it will occur in it only once.</p>
          </li></ul></div>

        <p>Sets are represented by the type
        <code class="literal">set[</code><em class="replaceable"><code>T</code></em><code class="literal">]</code>,
        where <em class="replaceable"><code>T</code></em> is an arbitrary type. Examples are
        <code class="literal">set[int]</code>, <code class="literal">set[tuple[int,int]]</code>
        and <code class="literal">set[set[str]]</code>. Sets are denoted by a list of
        elements, separated by comma's and enclosed in braces as in
        <code class="literal">{</code><em class="replaceable"><code>E</code></em><sub>1</sub><code class="literal">,</code>
        <em class="replaceable"><code>E</code></em><sub>2</sub><code class="literal">,
        ...,</code>
        <em class="replaceable"><code>E</code></em><sub><em class="replaceable"><code>n</code></em></sub><code class="literal">}</code>,
        where the
        <em class="replaceable"><code>E</code></em><sub><em class="replaceable"><code>n</code></em></sub>
        (1 &lt;= <em class="replaceable"><code>i</code></em>&lt;=
        <em class="replaceable"><code>n</code></em>) are expressions that yield the desired
        element type. For example,</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="literal">{1, 2, 3}</code> is of type
            <code class="literal">set[int]</code>,</p>
          </li><li class="listitem">
            <p><code class="literal">{&lt;1,10&gt;, &lt;2,20&gt;,
            &lt;3,30&gt;}</code> is of type
            <code class="literal">set[tuple[int,int]]</code>,</p>
          </li><li class="listitem">
            <p><code class="literal">{1, "b", 3}</code> is of type
            <code class="literal">set[value]</code>,</p>
          </li><li class="listitem">
            <p><code class="literal">{&lt;"a",10&gt;, &lt;"b",20&gt;,
            &lt;"c",30&gt;}</code> is of type
            <code class="literal">set[tuple[str,int]]</code>, and</p>
          </li><li class="listitem">
            <p><code class="literal">{{"a", "b"}, {"c", "d", "e"}}</code> is of type
            <code class="literal">set[set[str]]</code>.</p>
          </li></ul></div>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            <p><code class="literal">{1, 2, 3}</code> and <code class="literal">{3, 2,
            1}</code> are identical sets.</p>
          </div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            <p><code class="literal">{1, 2, 3}</code> and <code class="literal">{1, 2, 3,
            1}</code> are also identical sets.</p>
          </div><p>In a similar fashion as with lists, sets variables are
        automatically spliced into a surrounding set. This can be prevented by
        surrounding them with extra { and } brackets.</p><pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>S = {1, 2, 3};</code></strong>
<code class="computeroutput">set[int]: {1,2,3]}</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>{10, S, 20};</code></strong>
<code class="computeroutput">set[int]: {10, 1, 2, 3, 20]}</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>{10, {L}, 20};</code></strong>
<code class="computeroutput">lsetist[value]: {10, {1,2,3}, 20}</code></pre>

        <p title="Map">
          <b>Map.&nbsp;</b>

          A map is a set of key : value pairs and has the following
          properties:
        </p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>Key and value may have different static types.</p>
          </li><li class="listitem">
            <p>A key can only occur once.</p>
          </li></ul></div>

        <p>Maps are represented by the type
        <code class="literal">map[</code><em class="replaceable"><code>T</code></em><code class="literal"><sub>1</sub>,
        <em class="replaceable"><code>T</code></em><sub>2</sub>]</code>, where
        <em class="replaceable"><code>T</code></em><code class="literal"><sub>1</sub> and
        <em class="replaceable"><code>T</code></em><sub>2</sub></code> are
        arbitrary types. Examples are <code class="literal">map[int,int]</code>, and
        <code class="literal">map[str,int]</code>. Maps are denoted by a list of pairs,
        separated by comma's and enclosed in parentheses as in
        <code class="literal">(</code><em class="replaceable"><code>K</code></em><sub>1</sub><code class="literal">:</code>
        <em class="replaceable"><code>V</code></em><sub>1</sub><code class="literal">,
        ...,</code>
        <em class="replaceable"><code>K</code></em><sub>n</sub><code class="literal">:</code>
        <em class="replaceable"><code>V</code></em><sub>n</sub><code class="literal">)</code>,
        where the
        <em class="replaceable"><code>K</code></em><sub><em class="replaceable"><code>n</code></em></sub>
        (1 &lt;= <em class="replaceable"><code>i</code></em>&lt;=
        <em class="replaceable"><code>n</code></em>) are expressions that yield the keys of
        the map and
        <em class="replaceable"><code>V</code></em><sub><em class="replaceable"><code>n</code></em></sub>
        (1 &lt;= <em class="replaceable"><code>i</code></em>&lt;=
        <em class="replaceable"><code>n</code></em>) are expressions that yield the values
        for each key. Maps resemble functions rather than relations in the
        sense that only a single value can be associated with each key. For
        example,</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="literal">("pear" : 1, "apple" : 3, "banana" : 0)</code>
            is of type <code class="literal">map[str,int]</code>.</p>
          </li></ul></div>

        <p title="Tuple">
          <b>Tuple.&nbsp;</b>

          A tuple is a sequence of elements with the following
          properties:
        </p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>Each element in a tuple (may) have a different type.</p>
          </li><li class="listitem">
            <p>Each element of a tuple may have a label that can be used to
            select that element of the tuple.</p>
          </li></ul></div>

        <p>Tuples are represented by the type
        <code class="literal">tuple[</code><em class="replaceable"><code>T</code></em><sub>1</sub><code class="literal"><em class="replaceable"><code>L</code></em><sub>1</sub>,</code>
        <em class="replaceable"><code>T</code></em><sub>2</sub><code class="literal"><em class="replaceable"><code>L<sub>2</sub></code></em>,
        ...,</code>
        <em class="replaceable"><code>T</code></em><sub><em class="replaceable"><code>n</code></em></sub>
        <em class="replaceable"><code>L</code></em><sub>n</sub> ], where
        <em class="replaceable"><code>T</code></em><sub>1</sub><code class="literal">,</code>
        <em class="replaceable"><code>T</code></em><sub>2</sub><code class="literal">,
        ...,</code>
        <em class="replaceable"><code>T</code></em><sub><em class="replaceable"><code>n</code></em></sub>
        are arbitrary types and
        <em class="replaceable"><code>L<sub>1</sub></code></em><code class="literal">,</code>
        <em class="replaceable"><code>L</code></em><sub>2</sub><code class="literal">,
        ...,</code> <em class="replaceable"><code>L</code></em><sub>n</sub>
        are optional labels. An example of a tuple type is <code class="literal">tuple[str
        name, int freq]</code>. Examples are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="literal">&lt;1, 2&gt;</code> is of type
            <code class="literal">tuple[int, int]</code>,</p>
          </li><li class="listitem">
            <p><code class="literal">&lt;1, 2, 3&gt;</code> is of type
            <code class="literal">tuple[int, int, int]</code>,</p>
          </li><li class="listitem">
            <p><code class="literal">&lt;"a", 3&gt;</code> is of type
            <code class="literal">tuple[str name, int freq].</code></p>
          </li></ul></div>

        <p>The elements of a tuple can also be labelled and can then be
        accessed using the field selection operator (<code class="literal">.</code>).
        Fields can be changed (yielding a new tuple value) by a combination of
        field selection and assignment. For instance,</p><pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>tuple[str first, str last, int age] P = &lt;"Jo", "Jones", 35&gt;;</code></strong>
<code class="computeroutput">tuple[str first, str last, int age] P = &lt;"Jo", "Jones", 35&gt;;
</code>
<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>P.first;</code></strong>
<code class="computeroutput">str: "Jo"</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>P.first = "Bo";</code></strong>
<code class="computeroutput">tuple[str first,str last,int age]: &lt;"Bo","Jones",35&gt;</code></pre>

        <p title="Relation">
          <b>Relation.&nbsp;</b>

          A relation is a set of elements with the following
          property:
        </p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>All elements have the same static tuple type.</p>
          </li></ul></div>

        <p>Relations are thus nothing more than sets of tuples, but since
        they are used so often we provide a shorthand notation for them.
        Relations are represented by the type
        <code class="literal">rel[</code><em class="replaceable"><code>T</code></em><sub>1</sub><code class="literal"><em class="replaceable"><code>L</code></em><sub>1</sub>,</code>
        <em class="replaceable"><code>T</code></em><sub>2</sub><code class="literal"><em class="replaceable"><code>L<sub>2</sub></code></em>,
        ...,</code>
        <em class="replaceable"><code>T</code></em><sub><em class="replaceable"><code>n</code></em></sub>
        <em class="replaceable"><code>L</code></em><sub>n</sub> ], where
        <em class="replaceable"><code>T</code></em><sub>1</sub><code class="literal">,</code>
        <em class="replaceable"><code>T</code></em><sub>2</sub><code class="literal">,
        ...,</code>
        <em class="replaceable"><code>T</code></em><sub><em class="replaceable"><code>n</code></em></sub>
        are arbitrary types and
        <em class="replaceable"><code>L<sub>1</sub></code></em><code class="literal">,</code>
        <em class="replaceable"><code>L</code></em><sub>2</sub><code class="literal">,
        ...,</code> <em class="replaceable"><code>L</code></em><sub>n</sub>
        are optional labels. It is a shorthand for
        <code class="literal">set[tuple[</code><em class="replaceable"><code>T</code></em><sub>1</sub><code class="literal"><em class="replaceable"><code>L</code></em><sub>1</sub>
        ,</code>
        <em class="replaceable"><code>T</code></em><sub>2</sub><code class="literal"><em class="replaceable"><code>L<sub>2</sub></code></em>,
        ...,</code>
        <em class="replaceable"><code>T</code></em><sub><em class="replaceable"><code>n</code></em></sub>
        <em class="replaceable"><code>L</code></em><sub>n</sub>
        ]<code class="literal">]</code>. Examples are <code class="literal">rel[int,str]</code>
        and <code class="literal">rel[int,set[str]]</code>. An n-ary relations with m
        tuples is denoted by
        <code class="literal">{&lt;</code><em class="replaceable"><code>E</code></em><sub>11</sub><code class="literal">,</code>
        <em class="replaceable"><code>E</code></em><sub>12</sub><code class="literal">, ...,
        <em class="replaceable"><code>E</code></em><sub>1n</sub>&gt;,</code><code class="literal">&lt;</code><em class="replaceable"><code>E</code></em><sub>21</sub><code class="literal">,</code>
        <em class="replaceable"><code>E</code></em><sub>22</sub><code class="literal">, ...,
        <em class="replaceable"><code>E</code></em><sub>2n</sub>&gt;</code><code class="literal">,
        ...,</code><code class="literal">&lt;</code><em class="replaceable"><code>E</code></em><sub>m1</sub><code class="literal">,</code>
        <em class="replaceable"><code>E</code></em><sub>m2</sub><code class="literal">, ...,
        <em class="replaceable"><code>E</code></em><sub>mn</sub>&gt;</code><code class="literal">}</code>,
        where the
        <em class="replaceable"><code>E</code></em><sub><em class="replaceable"><code>i</code></em><em class="replaceable"><code>j</code></em></sub>
        are expressions that yield the desired element type. For example,
        <code class="literal">{&lt;1, "a"&gt;, &lt;2, "b"&gt;, &lt;3,"c"&gt;}</code> is
        of type <code class="literal">rel[int, str]</code>. Examples are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="literal">{&lt;1,10&gt;, &lt;2,20&gt;,
            &lt;3,30&gt;}</code> is of type <code class="literal">rel[int,int]</code>
            (yes indeed, you saw this same example before and then we gave
            <code class="literal">set[tuple[int,int]]</code> as its type; remember that
            these types are interchangeable.),</p>
          </li><li class="listitem">
            <p><code class="literal">{&lt;"a",10&gt;, &lt;"b",20&gt;,
            &lt;"c",30&gt;}</code> is of type
            <code class="literal">rel[str,int]</code>, and</p>
          </li><li class="listitem">
            <p><code class="literal">{&lt;"a", 1, "b"&gt;, &lt;"c", 2,
            "d"&gt;}</code> is of type
            <code class="literal">rel[str,int,str]</code>.</p>
          </li></ul></div>
      </div>

      <div class="section" title="Alias Type"><div class="titlepage"><div><div><h4 class="title"><a name="section.alias"></a>Alias Type</h4></div></div></div>
        

        <p>Everything can be expressed using the elementary types and
        values that are provided by Rascal. However, for the purpose of
        documentation and readability it is sometimes better to use a
        descriptive name as type indication, rather than an elementary type.
        The alias declaration</p>

        <pre class="programlisting">alias <em class="replaceable"><code>Name</code></em>  = <em class="replaceable"><code>Type</code></em>;</pre>

        <p>states that <em class="replaceable"><code>Name</code></em> can be used
        everywhere instead of the already defined type
        <em class="replaceable"><code>Type</code></em>. Both types are thus structurally
        equivalent. For instance,</p>

        <pre class="programlisting">alias ModuleId = str;
alias Frequency = int;</pre>

        <p>introduces two new type names <code class="literal">ModuleId</code> and
        <code class="literal">Frequency</code>, both an alias for the type
        <code class="literal">str</code>. The use of type aliases is a good way to
        document your intentions. Another example is an alias definition for a
        graph containing integer nodes:</p>

        <pre class="programlisting">alias IntGraph = rel[int,int];</pre>

        <p>Note that Rascal Standard Library provides a graph data type
        that is defined as follows:</p>

        <pre class="programlisting">alias Graph[&amp;T] = rel[&amp;T, &amp;T];</pre><p>In
        other words the standard graph datatype can be parameterized with any
        element type. See <a class="xref" href="ch01s07.html#section.lib-Graph" title="Graph">the section called &ldquo;Graph&rdquo;</a> for
        details.</p>
      </div>

      <div class="section" title="Data Type"><div class="titlepage"><div><div><h4 class="title"><a name="section.abstract-data-type"></a>Data Type</h4></div></div></div>
        

        <p>In ordinary programming languages record types or classes exist
        to introduce a new type name for a collection of related, named,
        values and to provide access to the elements of such a collection
        through their name. In Rascal, data declarations provide this
        facility. The type declaration</p>

        <pre class="programlisting"><code class="literal">data <em class="replaceable"><code>Name</code></em> = <em class="replaceable"><code>Pat</code></em><sub>1</sub> | <em class="replaceable"><code>Pat</code></em><sub>1</sub> | ...</code></pre>

        <p>introduces a new datatype <em class="replaceable"><code>Name</code></em> and
        <em class="replaceable"><code>Pat</code></em><sub>1</sub>,
        <em class="replaceable"><code>Pat</code></em><sub>2</sub>, ... are prefix
        patterns describing the variants of the datatype. For instance,
        </p><pre class="programlisting">data Bool = T | F | conj(Bool L, Bool R)  | disj(Bool L, Bool R);  </pre><p>defines
        the datatype <code class="literal">Bool</code> that contains various constants
        (<code class="literal">T</code> and <code class="literal">F</code>) and constructor
        functions <code class="literal">conj</code> and <code class="literal">disj</code>.</p>
      </div>

      <div class="section" title="Type Parameters and Parameterized types"><div class="titlepage"><div><div><h4 class="title"><a name="N21779"></a>Type Parameters and Parameterized types</h4></div></div></div>
        

        <p>In addition to the types that we have already discussed, a type
        may also be a <span class="emphasis"><em>type parameter</em></span> of the
        form</p><pre class="programlisting"><code class="literal">&amp;</code><em class="replaceable"><code>Name</code></em></pre><p>A
        type parameter may occur at every syntactic position where a type is
        required and turns an ordinary type into a parameterized type.
        Parameterized types are used to define polymorphic functions and data
        types, i.e., functions and data types that are applicable for more
        than one type. Type parameters are bound to an actual type when the
        function or data type is applied and further uses of the type
        parameter are consistently replaced by the actual type.</p>

        <p>The following syntactic positions are <span class="emphasis"><em>binding
        occurrences</em></span> for type parameters:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>Type parameters in the type declaration of a function are
            bound to the types of the actual parameters in the call of that
            function. Type parameters that occur in the body of the function
            are replaced by the corresponding actual type.</p>
          </li><li class="listitem">
            <p>The left-hand side of an alias. The type parameters are
            bound when the alias is used and occurrences of type parameters in
            the right hand side are replaced by corresponding actual
            types.</p>
          </li><li class="listitem">
            <p>The alternatives of a data type. Binding and replacement is
            identical to that of function declarations.</p>
          </li></ul></div>

        <p>All other occurrences of type parameters are <span class="emphasis"><em>using
        occurrences</em></span>. The following rules apply:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>When the same type parameter is used at different binding
            occurrences it should be bound to the same actual type.</p>
          </li><li class="listitem">
            <p>For every using occurrence of a type parameter there should
            be a binding occurrence of a type parameter with the same
            name.</p>
          </li></ul></div>

        <p>We refer to <a class="xref" href="ch01s06.html#section.function" title="Function Declaration">the section called &ldquo;Function Declaration&rdquo;</a> for a full
        description of function declaration, but here</p>

        <p>The following function <code class="literal">swap</code> returns a tuple
        in which its arguments are swapped and can be applied to arbitrary
        values in a type safe manner:</p><pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>tuple[&amp;B, &amp;A] swap(&amp;A a, &amp;B b) { return &lt;b, a&gt;; }</code></strong>
<code class="computeroutput">ok</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>swap(1,2);</code></strong>
<code class="computeroutput">tuple[int,int]: &lt;2,1&gt;
</code>
<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>swap("abc", 3);</code></strong>
<code class="computeroutput">tuple[int,str]: &lt;3, "abc"&gt;</code></pre><p>Observe
        that the type parameters that occur in the return type should occur in
        the formal parameter types of the function.</p>

        <p>An alias definition may be parameterized. So we can generalize
        graphs as follows:</p>

        <pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>alias Graph[&amp;Node] = rel[&amp;Node, &amp;Node];</code></strong>
<code class="computeroutput">ok</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>Graph[int] GI = {&lt;1,2&gt;, &lt;3,4&gt;, &lt;4,1&gt;};</code></strong>
<code class="computeroutput">Graph[int] :  {&lt;1,2&gt;, &lt;3,4&gt;, &lt;4,1&gt;}
</code>
<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>Graph[str] GS = {&lt;"a", "b"&gt;, &lt;"c","d"&gt;, &lt;"d", "a"&gt;};</code></strong>
<code class="computeroutput">Graph[str] : {&lt;"a", "b"&gt;, &lt;"c","d"&gt;, &lt;"d", "a"&gt;}</code></pre><p>Of
        course, the type variables that are used in the type in the left part
        of the alias declaration should occur as parameters in the right part
        of the definition and vice versa.</p>
      </div>

      <div class="section" title="Typing"><div class="titlepage"><div><div><h4 class="title"><a name="N21804"></a>Typing</h4></div></div></div>
        

        <p><a name="figure.type-lattice"></a>Rascal is based on static typing,
        this means that as many errors and inconsistencies as possible are
        spotted before the program is executed. The types introduced earlier
        are ordered in a so-called <span class="emphasis"><em>type lattice</em></span> shown in
        <a class="xref" href="ch01s06.html#figure.type-lattice">the section called &ldquo;Typing&rdquo;</a>. The arrows describe a
        <span class="emphasis"><em>subtype-of</em></span> relation between types. The type void
        is the <span class="emphasis"><em>smallest</em></span> type and is included in all other
        types and the type value is the <span class="emphasis"><em>largest</em></span> type that
        includes all other types. We also see that <code class="literal">rel</code> is a
        subtype of <code class="literal">set</code> and that each ADT is a subtype of
        <code class="literal">node</code>. Finally, each alias is structurally
        equivalent to one or more specific other types.</p><div class="figure"><a name="N21824"></a><p class="title"><b>Figure&nbsp;1.18.&nbsp;The Rascal Type Lattice</b></p><div class="figure-contents">
            

            <div class="mediaobject"><img src="type-lattice.png" width="270" alt="The Rascal Type Lattice"></div>
          </div></div><p><br class="figure-break"></p>
      </div>
    </div>

    <div class="section" title="Declarations"><div class="titlepage"><div><div><h3 class="title"><a name="section.declarations"></a>Declarations</h3></div></div></div>
      

      <div class="section" title="Rascal Program"><div class="titlepage"><div><div><h4 class="title"><a name="N2183C"></a>Rascal Program</h4></div></div></div>
        

        <p>A Rascal program consists of a number of modules that may import
        each other.</p>
      </div>

      <div class="section" title="Module"><div class="titlepage"><div><div><h4 class="title"><a name="N21845"></a>Module</h4></div></div></div>
        

        <p>A module declaration has the following form:</p>

        <pre class="programlisting"><span class="keysym">module</span> <em class="replaceable"><code>Name</code></em>
<code class="literal"><em class="replaceable"><code>Imports;
Declaration</code></em><sub>1</sub>;
...
<em class="replaceable"><code>Declaration</code></em><sub>n</sub>;</code></pre><p>and
        consists of a <em class="replaceable"><code>Name</code></em> and zero or more imports
        of other modules (<a class="xref" href="ch01s06.html#section.import" title="Import">the section called &ldquo;Import&rdquo;</a>) and declarations
        for</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>Data type, see <a class="xref" href="ch01s06.html#section.abstract-data-type" title="Data Type">the section called &ldquo;Data Type&rdquo;</a>.</p>
          </li><li class="listitem">
            <p>Alias, see <a class="xref" href="ch01s06.html#section.alias" title="Alias Type">the section called &ldquo;Alias Type&rdquo;</a>.</p>
          </li><li class="listitem">
            <p>Variable, see <a class="xref" href="ch01s06.html#section.variable" title="Variable Declaration">the section called &ldquo;Variable Declaration&rdquo;</a>.</p>
          </li><li class="listitem">
            <p>Function, see <a class="xref" href="ch01s06.html#section.function" title="Function Declaration">the section called &ldquo;Function Declaration&rdquo;</a>.</p>
          </li><li class="listitem">
            <p>Rewrite rule, see <a class="xref" href="ch01s06.html#section.rewrite-rule" title="Rewrite Rule Declaration">the section called &ldquo;Rewrite Rule Declaration&rdquo;</a>.</p>
          </li><li class="listitem">
            <p>Node annotation, see <a class="xref" href="ch01s06.html#section.node-annotation" title="Node Annotation Declaration">the section called &ldquo;Node Annotation Declaration&rdquo;</a>.</p>
          </li><li class="listitem">
            <p>Declaration tag, see <a class="xref" href="ch01s06.html#section.declaration-tag" title="Declaration Tag">the section called &ldquo;Declaration Tag&rdquo;</a>.</p>
          </li></ul></div>

        <p>The module name <em class="replaceable"><code>Name</code></em> will be used
        when the current module is imported in another module. A module is
        usually a qualified name of the form:</p><pre class="programlisting"><em class="replaceable"><code>Name</code></em><sub>1</sub><code class="literal">::</code><em class="replaceable"><code>Name</code></em><sub>2</sub><code class="literal">::</code> ... <code class="literal">::</code><em class="replaceable"><code>Name</code></em><sub>n</sub></pre>

        <p>which corresponds to a path relative to the root of the current
        workspace.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
            <p>Explain this better.</p>
          </div>

        <p>The constituents of a module are also shown in <a class="xref" href="ch01s06.html#figure.parts-module" title="Figure&nbsp;1.19.&nbsp;Constituents of a Module">Figure&nbsp;1.19, &ldquo;Constituents of a Module&rdquo;</a>. The more sophisticated features are
        shown in a separate color.</p>

        <p>The entities that are <span class="emphasis"><em>visible</em></span> inside a
        module are</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>The private or public entities declared in the module
            itself.</p>
          </li><li class="listitem">
            <p>The public entities declared in any imported module.</p>
          </li></ul></div>

        <p>The only entities that are visible outside the module, are the
        public entities declared in the module itself. The visible entities of
        an imported may be explicitly qualified with their module
        name:</p><pre class="programlisting"><em class="replaceable"><code>Module</code></em><code class="literal">::</code><em class="replaceable"><code>Name</code></em></pre><div class="figure"><a name="figure.parts-module"></a><p class="title"><b>Figure&nbsp;1.19.&nbsp;Constituents of a Module</b></p><div class="figure-contents">
            

            <div class="mediaobject"><img src="module-parts.png" width="270" alt="Constituents of a Module"></div>
          </div></div><p><br class="figure-break"></p>
      </div>

      <div class="section" title="Import"><div class="titlepage"><div><div><h4 class="title"><a name="section.import"></a>Import</h4></div></div></div>
        

        <p>An import has the form:</p><pre class="programlisting"><span class="keysym">import</span> <code class="literal"><em class="replaceable"><code>QualifiedName</code></em>;</code></pre><p>and
        has as effect that all public entities declared in module
        <em class="replaceable"><code>QualifiedName</code></em> are made available to the
        importing module. Circular imports are allowed.</p>
      </div>

      <div class="section" title="Function Declaration"><div class="titlepage"><div><div><h4 class="title"><a name="section.function"></a>Function Declaration</h4></div></div></div>
        

        <p>A function declaration has the form</p><pre class="programlisting"><em class="replaceable"><code>Type</code></em> <em class="replaceable"><code>Name</code></em>(<code class="literal"><em class="replaceable"><code>Type</code></em></code><sub>1</sub> <em class="replaceable"><code>Var</code></em><sub>1</sub>, ..., <em class="replaceable"><code>Type</code></em><sub><em class="replaceable"><code>n</code></em></sub> <em class="replaceable"><code>Var</code></em><em class="replaceable"><code><sub>n</sub></code></em>) <em class="replaceable"><code>Statement</code></em></pre><p>Here
        <em class="replaceable"><code>Type</code></em> is the result type of the function and
        this should be equal to the type of the result of Statement (using the
        return statement, see <a class="xref" href="ch01s06.html#section.return" title="Return Statement">the section called &ldquo;Return Statement&rdquo;</a>). Each
        <em class="replaceable"><code>Type</code></em><sub><em class="replaceable"><code>i</code></em></sub>
        <em class="replaceable"><code>Var</code></em><em class="replaceable"><code><sub>i</sub></code></em>
        represents a typed formal parameter of the function. The formal
        parameters may be used in <em class="replaceable"><code>Statement</code></em> and get
        their value when function <em class="replaceable"><code>Name</code></em> is invoked.
        Example:</p><pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>rel[int, int] invert(rel[int,int] R){
            return {&lt;Y, X&gt; | &lt;int X, int Y&gt; &lt;- R }
        }</code></strong>
<code class="computeroutput">ok</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code><code class="literal">invert({&lt;1,10&gt;, &lt;2,20&gt;})</code>;</code></strong>
<code class="computeroutput">rel[int,int] : {&lt;10,1&gt;, &lt;20,2&gt;}</code></pre>

        <p title="Variable argument lists">
          <b>Variable argument lists.&nbsp;</b>

          A function may have a variable list of arguments, this has the
          form:</p><pre class="programlisting"><em class="replaceable"><code>Type</code></em> <em class="replaceable"><code>Name</code></em>(<span class="emphasis"><em>ordinary parameters</em></span>, <em class="replaceable"><code>Type</code></em> <em class="replaceable"><code>Var</code></em>...) <em class="replaceable"><code>Statement</code></em></pre><p title="Variable argument lists">
        </p>

        <p>The last parameter of a function may be followed by
        <code class="literal">...</code> and this has as effect that all remaining
        actual parameters that occur in a call to this function are collected
        as list value of the last formal parameter. Inside the function body,
        the type of this parameter will therefore be
        <code class="literal">list[</code><em class="replaceable"><code>Type</code></em><code class="literal">]</code>.</p>

        <p title="Exceptions">
          <b>Exceptions.&nbsp;</b>

          The exceptions that can be thrown by a function can be
          (optionally) declared as follows:</p><pre class="programlisting"><em class="replaceable"><code>Type</code></em> <em class="replaceable"><code>Name</code></em>(<code class="literal"><em class="replaceable"><code>Type</code></em></code><sub>1</sub> <em class="replaceable"><code>Var</code></em><sub>1</sub>, ..., <em class="replaceable"><code>Type</code></em><sub><em class="replaceable"><code>n</code></em></sub> <em class="replaceable"><code>Var</code></em><em class="replaceable"><code><sub>n</sub></code></em>) 
     throws <em class="replaceable"><code>Exception</code></em><sub>1</sub>, <em class="replaceable"><code>Exception</code></em><sub>2</sub>, ...<em class="replaceable"><code> </code></em></pre><p title="Exceptions">See
          <a class="xref" href="ch01s06.html#section.try-catch" title="Try Catch Statement">the section called &ldquo;Try Catch Statement&rdquo;</a> and <a class="xref" href="ch01s06.html#section.throw" title="Throw Statement">the section called &ldquo;Throw Statement&rdquo;</a> for details.
        </p>

        <p title="Parameterized types in function declaration">
          <b>Parameterized types in function declaration.&nbsp;</b>

          The types that occur in function declarations may also contain
          <span class="emphasis"><em>type variables</em></span> that are written as
          <code class="literal">&amp;</code> followed by an identifier. In this way
          functions can be defined for arbitrary types. In the following
          example, we declare an inversion function that is applicable to any
          binary relation. :</p><pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>rel[&amp;T2, &amp;T1] invert2(rel[&amp;T1,&amp;T2] R){  
            return {&lt;Y, X&gt; | &lt;&amp;T1 X, &amp;T2 Y&gt; &lt;- R };
        }</code></strong>
<code class="computeroutput">ok</code>

<code class="prompt">rascal&gt;</code><code class="literal"> </code><strong class="userinput"><code><code class="literal">invert2({&lt;1,10&gt;, &lt;2,20&gt;})</code>;</code></strong>
<code class="computeroutput">rel[int,int] : {&lt;10,1&gt;, &lt;20,2&gt;}
</code>
<code class="prompt">rascal&gt;</code><code class="literal"> </code><strong class="userinput"><code><code class="literal">invert2({&lt;"mon", 1&gt;, &lt;"tue", 2&gt;})</code>;</code></strong>
<code class="computeroutput">rel[int,str] : {&lt;1, "mon"&gt;, &lt;2, "tue"&gt;}</code></pre><p title="Parameterized types in function declaration">Here
          we declare a function that can be used to swap the elements of pairs
          of arbitrary types:</p><pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>&lt;&amp;T2, &amp;T1&gt; swap(&amp;T1 A, &amp;T2 B) { return &lt;B, A&gt;;;}</code></strong>
<code class="computeroutput">ok</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code><code class="literal">swap(&lt;1, 2&gt;)</code>;</code></strong>
<code class="computeroutput"><code class="literal">tuple[int,int] : &lt;2,1&gt;</code></code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>swap(&lt;"wed", 3&gt;);</code></strong>
<code class="computeroutput">tuple[int,str] : &lt;3, "wed"&gt;</code></pre><p title="Parameterized types in function declaration">
        </p>
      </div>

      <div class="section" title="Variable Declaration"><div class="titlepage"><div><div><h4 class="title"><a name="section.variable"></a>Variable Declaration</h4></div></div></div>
        

        <p>A variable declaration has the form</p><pre class="programlisting"><em class="replaceable"><code>T</code></em>ype <em class="replaceable"><code>V</code></em>ar = <em class="replaceable"><code>Exp</code></em></pre><p>where
        <em class="replaceable"><code>Type</code></em> is a type,
        <em class="replaceable"><code>Var</code></em> is a variable name, and
        <em class="replaceable"><code>Exp</code></em> is an expression that should have type
        <em class="replaceable"><code>Type</code></em>. The effect is that the value of
        expression <em class="replaceable"><code>Exp</code></em> is assigned to
        <em class="replaceable"><code>Var</code></em> and can be used later on as
        <em class="replaceable"><code>Var</code></em>'s value. The following rules
        apply:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>Double declarations in the same scope are not
            allowed.</p>
          </li><li class="listitem">
            <p>The type of <em class="replaceable"><code>Exp</code></em> should be
            compatible with <em class="replaceable"><code>Type</code></em>.</p>
          </li></ul></div>

        <p>As a convenience, also declarations without an initialization
        expression are permitted inside functions (but not at the module
        level) and have the form </p><pre class="programlisting"><em class="replaceable"><code>T</code></em>ype <em class="replaceable"><code>V</code></em>ar </pre><p>and
        only introduce the variable <em class="replaceable"><code>Var</code></em>. When a
        variable is declared, it has as scope the nearest enclosing block (see
        <a class="xref" href="ch01s06.html#section.block" title="Block Statement">the section called &ldquo;Block Statement&rdquo;</a>).</p>

        <p>Rascal provides <span class="emphasis"><em>local type inference</em></span>, which
        allows the implicit declaration for variables that are used locally in
        functions. The following rules apply:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>An implicitly declared variable is declared at the level of
            the function body.</p>
          </li><li class="listitem">
            <p>An implicitly declared variable gets as type the type of the
            first value that is assignment to it.</p>
          </li><li class="listitem">
            <p>If a variable is implicitly declared in different execution
            path of a function, all these implicit declarations should result
            in the same type.</p>
          </li><li class="listitem">
            <p>All uses of an implicitly declared variable must be
            compatible with its implicit type.</p>
          </li></ul></div>

        <p>Examples.</p><pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>int max = 100;</code></strong>
<code class="computeroutput">int: 100</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>min = 0</code></strong>;
<code class="computeroutput">int : 0</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>day = {&lt;"mon", 1&gt;, &lt;"tue", 2&gt;, &lt;"wed",3&gt;, 
              &lt;"thu", 4&gt;, &lt;"fri", 5&gt;, &lt;"sat",6&gt;, &lt;"sun",7&gt;}</code></strong>
<code class="computeroutput">rel[str,int]: {&lt;"mon", 1&gt;, &lt;"tue", 2&gt;, &lt;"wed",3&gt;, 
               &lt;"thu", 4&gt;, &lt;"fri", 5&gt;, &lt;"sat",6&gt;, &lt;"sun",7&gt;}</code></pre>
      </div>

      <div class="section" title="Declaration Tag"><div class="titlepage"><div><div><h4 class="title"><a name="section.declaration-tag"></a>Declaration Tag</h4></div></div></div>
        

        <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
            <p>Tags are not yet implemented.</p>
          </div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
            <p>The syntax of tags has to be aligned with the syntax of
            annotations. This is done in the examples below but not yet in the
            syntax.</p>
          </div><p>Tags are intended to add meta data to a Rascal program and
        allow to influence the execution of the Rascal program, for instance,
        by adding memoization hints or database mappings for relations.</p>

        <p>All declarations in a Rascal program may contain (in fixed
        positions depending on the declaration type) one or more declaration
        tags (<code class="literal">tag</code>). A tag is defined by declaring its name,
        the declaration type to which it can be attached, and the name and
        type of the annotation. The declaration type <code class="literal">all</code>,
        makes the declaration tag applicable for all possible declaration
        types. All declaration tags have the generic format
        <code class="literal">@<em class="replaceable"><code>Name</code></em>{ ... }</code>, with
        arbitrary text between the brackets that is further constrained by the
        declared type. Here is an example of a license tag:</p><pre class="programlisting">tag str license on module;</pre><p>This
        will allow to write things like:</p><pre class="programlisting">module Booleans
@license{This module is distributed under the GPL}
...</pre><p>Other examples of declaration tags are:</p><pre class="programlisting">tag str todo on all             %% todo note for all types
tag void deprecated on function %% marks a deprecated function
tag int memo on function        %% bounded memoization of 
                                %% function calls
tag str doc on all              %% documentation string
tag str primitive on function   %% a primitive, built-in, function</pre><p>Here
        is an example of a documentation string as used in the Rascal standard
        library:</p><pre class="programlisting">public &amp;T max(set[&amp;T] R)
  @doc{Maximum of a set: max}
{
  &amp;T result = arb(R);
  for(&amp;T E : R){
    result = max(result, E);
  }
  return result;
}</pre>
      </div>

      <div class="section" title="Node Annotation Declaration"><div class="titlepage"><div><div><h4 class="title"><a name="section.node-annotation"></a>Node Annotation Declaration</h4></div></div></div>
        

        <p>An annotation may be associated with any node value. Annotations
        are intended to attach application data to values, like adding
        position information or control flow information to source code or
        adding visualization information to a relation. An annotation has a
        name and the type of its value is explicitly declared. Any value of
        any named type can be annotated and the type of these annotations can
        be declared precisely.</p>

        <p>For instance, we can add to certain syntactic constructs of
        programs (e.g., <code class="literal">EXPRESSION</code>) an annotation with name
        <code class="literal">posinfo</code> that contains location
        information:</p><pre class="programlisting">anno loc EXPRESSION @ posinfo;</pre><p>or
        location information could be added for all syntax
        trees:</p><pre class="programlisting">anno loc node @ posinfo;</pre>

        <p>We can add to the graph datatype introduced earlier, the
        annotation with name <code class="literal">LayoutStrategy</code> that defines
        which graph layout algorithm to apply to a particular graph,
        e.g.,</p><pre class="programlisting">data LayoutStrategy = "dot" | "tree" | "force" | 
                      "hierarchy" | "fisheye";

anno LayoutStrategy Graph @ strategy;</pre>

        <p>The following constructs are provided for handling
        annotations:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="literal"><em class="replaceable"><code>Val</code></em> @
            <em class="replaceable"><code>Anno</code></em></code>: is an expression that
            retrieves the value of annotation <em class="replaceable"><code>Anno</code></em>
            of value <em class="replaceable"><code>Val</code></em> (may be
            undefined!).</p>
          </li><li class="listitem">
            <p><code class="literal"><em class="replaceable"><code>Val1</code></em>[@<em class="replaceable"><code>Anno</code></em>
            = <em class="replaceable"><code>Val2]</code></em></code>: is an expression
            that set the value of annotation <em class="replaceable"><code>Anno</code></em>
            of the value
            <em class="replaceable"><code>Val</code></em><em class="replaceable"><code>1</code></em> to
            <em class="replaceable"><code>Val2</code></em> and return <em><span class="remark">XXX</span></em> as
            result.</p>
          </li><li class="listitem">
            <p><code class="literal"><em class="replaceable"><code>Var</code></em> @
            <em class="replaceable"><code>Anno</code></em> =
            <em class="replaceable"><code>Val</code></em></code>: is an assignment
            statement that sets the value of annotation
            <em class="replaceable"><code>Anno</code></em> of the value of variable
            <em class="replaceable"><code>Var</code></em> to
            <em class="replaceable"><code>Val</code></em>.</p>
          </li></ul></div>
      </div>

      <div class="section" title="Rewrite Rule Declaration"><div class="titlepage"><div><div><h4 class="title"><a name="section.rewrite-rule"></a>Rewrite Rule Declaration</h4></div></div></div>
        

        <p>Functions are the workhorses of Rascal. They can have any value
        as parameter or result and are explicitly called by the user. Also,
        functions are declared inside modules and their visibility can be
        controlled.</p>

        <p>Rewrite rules, on the other hand, operate only on nodes and
        defined datatypes, they are implicitly applied when a new value (we
        refer to this as the <span class="emphasis"><em>subject value</em></span>) is
        constructed. The scope of rewrite rules is the whole Rascal program.
        Rewrite rules are applied to the subject value in a bottom-up fashion.
        As a result, the subject value may be changed. This process is
        repeated as long as there are rules that can be applied to the current
        subject value. Technically, this is called <span class="emphasis"><em>innermost
        rewriting</em></span>. When done, the result of rewriting the original
        subject value is used instead of that original value.</p>

        <p>Rules have the general form:</p><pre class="programlisting"><span class="keysym">rule</span> <em class="replaceable"><code>Name</code></em> <em class="replaceable"><code>PatternWithAction</code></em></pre>

        <p>where <em class="replaceable"><code>Name</code></em> is the name of the rule
        and <em class="replaceable"><code>PatternWithAction</code></em> is the body of the
        rule consisting of a pattern and an associated action (see <a class="xref" href="ch01s06.html#section.pattern-with-action" title="PatternWithAction">the section called &ldquo;PatternWithAction&rdquo;</a> for a detailed
        description).</p>

        <p>Here is an example for a user-defined type Booleans:</p><pre class="screen"><code class="prompt">rascal&gt;</code>
<strong class="userinput"><code>data Bool = btrue;
data Bool = bfalse;
data Bool = band(Bool left, Bool right);
data Bool = bor(Bool left, Bool right);  

rule a1 band(btrue, Bool B)    =&gt; B;
rule a2 band(bfalse, Bool B)   =&gt; bfalse;</code></strong>
<code class="computeroutput">ok</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>band(band(btrue,btrue),band(btrue, bfalse));</code></strong>
<code class="computeroutput">Bool: bfalse</code></pre>

        <p>During execution of rules the following applies:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>Rules are applied non-deterministically, and in any order of
            matching.</p>
          </li><li class="listitem">
            <p>The right-hand side of rules can contain fail statements,
            which cause backtracking over the alternative matches or
            alternative rules for a certain constructor.</p>
          </li><li class="listitem">
            <p>When the right-hand side is a statement, an
            <code class="literal">insert</code> statement determines the value of the
            actual replacement.</p>
          </li></ul></div>
      </div>
    </div>

    <div class="section" title="Expressions"><div class="titlepage"><div><div><h3 class="title"><a name="section.expressions"></a>Expressions</h3></div></div></div>
      

      <p>The Expression is the basic unit of evaluation and may consist of
      (see <a class="xref" href="ch01s06.html#figure.exp-parts" title="Figure&nbsp;1.20.&nbsp;Expression Forms">Figure&nbsp;1.20, &ldquo;Expression Forms&rdquo;</a>):</p>

      <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <p>An <span class="emphasis"><em>elementary literal value</em></span>, e.g.,
          constants of type <code class="literal">bool</code>, <code class="literal">int</code>,
          <code class="literal">real</code>, <code class="literal">str</code> or
          <code class="literal">loc</code>. Elementary literals evaluate to
          themselves.</p>
        </li><li class="listitem">
          <p>A <span class="emphasis"><em>structured literal value</em></span> for
          <code class="literal">list</code>, <code class="literal">set</code>,
          <code class="literal">map</code>, <code class="literal">tuple</code>, or
          <code class="literal">rel</code>. The elements are first evaluated before the
          structured value is built.</p>
        </li><li class="listitem">
          <p>A <span class="emphasis"><em>variable</em></span>, evaluates to its current
          value.</p>
        </li><li class="listitem">
          <p>A <span class="emphasis"><em>function call</em></span>. First the arguments are
          evaluated and the corresponding function is called. The value
          returned by the function is used as value of the function
          call.</p>
        </li><li class="listitem">
          <p>A <span class="emphasis"><em>constructor</em></span>. First the arguments are
          evaluated and then a data value is constructed for the corresponding
          type. This data value is used as value of the constructor.</p>
        </li><li class="listitem">
          <p>An <span class="emphasis"><em>operator expression</em></span>. The operator is
          applied to the arguments; the evaluation order of the arguments
          depends on the operator. The result returned by the operator is used
          as value of the operator expression.</p>
        </li><li class="listitem">
          <p>A visit expression, see <a class="xref" href="ch01s06.html#section.visit" title="Visit expression">the section called &ldquo;Visit expression&rdquo;</a>.</p>
        </li><li class="listitem">
          <p>A pattern, see <a class="xref" href="ch01s06.html#section.pattern" title="Patterns">the section called &ldquo;Patterns&rdquo;</a>.</p>
        </li><li class="listitem">
          <p>A pattern with associated action, see <a class="xref" href="ch01s06.html#section.pattern-with-action" title="PatternWithAction">the section called &ldquo;PatternWithAction&rdquo;</a>.</p>
        </li><li class="listitem">
          <p>A comprehension, see <a class="xref" href="ch01s06.html#section.comprehension" title="Comprehension Expression">the section called &ldquo;Comprehension Expression&rdquo;</a>.</p>
        </li><li class="listitem">
          <p>A one expression, see <a class="xref" href="ch01s06.html#section.one" title="One Expression">the section called &ldquo;One Expression&rdquo;</a>.</p>
        </li><li class="listitem">
          <p>An all expression, see <a class="xref" href="ch01s06.html#section.all" title="All Expression">the section called &ldquo;All Expression&rdquo;</a>.</p>
        </li></ul></div>

      <p>We explain the various operator expressions in more detail.
      Non-Boolean and Boolean operator expressions behave somewhat differently
      and therefore we describe separately.</p><div class="figure"><a name="figure.exp-parts"></a><p class="title"><b>Figure&nbsp;1.20.&nbsp;Expression Forms</b></p><div class="figure-contents">
          

          <div class="mediaobject"><img src="exp-parts.png" width="270" alt="Expression Forms"></div>
        </div></div><p><br class="figure-break"></p>

      <div class="section" title="Non-Boolean Operator Expressions"><div class="titlepage"><div><div><h4 class="title"><a name="section.expressions-non-boolean"></a>Non-Boolean Operator Expressions</h4></div></div></div>
        

        <p>The non-Boolean operators are summarized in <a class="xref" href="ch01s06.html#table.non-boolean-operators" title="Table&nbsp;1.2.&nbsp;Non-Boolean Operators">Table&nbsp;1.2, &ldquo;Non-Boolean Operators&rdquo;</a>. All operators are highly
        overloaded and we refer to <a class="xref" href="ch01s07.html" title="Built-in Operators and Library Functions">the section called &ldquo;Built-in Operators and Library Functions&rdquo;</a> for a
        description of their meaning for each specific type. The following
        rules apply:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>All <em class="replaceable"><code>name</code></em> arguments stand for
            themselves and are not evaluated.</p>
          </li><li class="listitem">
            <p>For all operators, except, IfThenElse, the argument
            expressions are first evaluated before the operator is
            applied.</p>
          </li><li class="listitem">
            <p>The operators in <a class="xref" href="ch01s06.html#table.non-boolean-operators" title="Table&nbsp;1.2.&nbsp;Non-Boolean Operators">Table&nbsp;1.2, &ldquo;Non-Boolean Operators&rdquo;</a> are listed from high
            precedence to low precedence. In other words, operators listed
            higher in the table bind stronger.</p>
          </li></ul></div>

        <div class="table"><a name="table.non-boolean-operators"></a><p class="title"><b>Table&nbsp;1.2.&nbsp;Non-Boolean Operators</b></p><div class="table-contents">
            

            <table summary="Non-Boolean Operators" border="1"><colgroup><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th align="left">Operator</th><th align="left">Name</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><em class="replaceable"><code>Exp</code></em> <code class="literal">.</code>
                  <em class="replaceable"><code>Name</code></em></td><td align="left">Field selection</td><td align="left"><em class="replaceable"><code>Exp </code></em>should evaluate to a
                  tuple or datatype with field
                  <em class="replaceable"><code>Name</code></em>; return the value of that
                  field</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub><code class="literal">
                  [</code> <em class="replaceable"><code>Name</code></em>
                  <code class="literal">=</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub>
                  <code class="literal">]</code></td><td align="left">Field assignment</td><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  should evaluate to a tuple or datatype with a field
                  <em class="replaceable"><code>Name</code></em>; assign value
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub> to
                  that field</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em>
                  <code class="literal">&lt;</code> <em class="replaceable"><code>field</code></em>,
                  ...<code class="literal"> &gt;</code></td><td align="left">Field projection</td><td align="left"><em class="replaceable"><code>Exp</code></em> should evaluate to a
                  tuple or relation, and field should be a field name or an
                  integer constant. A new tuple or relation is returned that
                  only contains the listed fields.</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub><code class="literal">
                  [</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub> ,
                  <code class="literal"><em class="replaceable"><code>Exp</code></em><sub>3</sub>,
                  .... ]</code></td><td align="left">Subscription</td><td align="left">The value of
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub> ,
                  <em class="replaceable"><code>Exp</code></em><sub>3</sub>, ...
                  are used as index in
                  <em class="replaceable"><code>Exp</code></em><sub>1</sub>'s
                  value. On list, tuple return the element with given
                  (single!) index value; for map return the value associated
                  with
                  <em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>2</sub>
                  </code></em>'s value. On relations more than one index is
                  allowed. All tuples are returned that have the values of
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub>,
                  <em class="replaceable"><code>Exp</code></em><sub>3</sub>, ...
                  as first elements. These values are removed from each
                  tuple.</td></tr><tr><td align="left"><code class="literal">-</code>
                  <em class="replaceable"><code>Exp</code></em></td><td align="left">Negation</td><td align="left">Negative of <em class="replaceable"><code>Exp</code></em>'s integer
                  or real value</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em>
                  <code class="literal">+</code></td><td align="left">Transitive closure</td><td align="left">Transitive closure on relation</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em>
                  <code class="literal">*</code></td><td align="left">Reflexive transitive closure</td><td align="left">Reflexive transitive closure on relation</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em> <code class="literal">@</code>
                  <em class="replaceable"><code>Name</code></em></td><td align="left">Annotation selection</td><td align="left">Value of annotation <em class="replaceable"><code>Name</code></em>
                  of <em class="replaceable"><code>Exp</code></em>'s value</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">[@</code> <em class="replaceable"><code>Name</code></em>
                  <code class="literal">=</code><em class="replaceable"><code>
                  Exp</code></em><sub>2</sub><code class="literal">]</code></td><td align="left">Annotation replacement</td><td align="left">Assign value of<em class="replaceable"><code>
                  Exp</code></em><sub>2</sub> to annotation
                  <em class="replaceable"><code>Name</code></em> of
                  <em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>1</sub></code></em>'s
                  value</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">o</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">Composition</td><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  and <em class="replaceable"><code>Exp</code></em><sub>2</sub>
                  should evaluate to a relation; return their
                  composition</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">/</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">Division</td><td align="left">Divide two integers and reals</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">%</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">Modulo</td><td align="left">Modulo on integer</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">*</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">Multiplication / Product</td><td align="left">Multiply integers or real; product of list, set,
                  relation</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">&amp;</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">Intersection</td><td align="left">Intersection of list, set, map or relation</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">+</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">Addition / concatenation / union</td><td align="left">Add integer and real; concatenate string, list or
                  tuple; union on set, map, or relation</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">-</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">Subtraction / difference</td><td align="left">Subtract integer or real; difference of list, set,
                  map, or relation</td></tr><tr><td align="left"><em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>1</sub></code></em>
                  <code class="literal">join</code>
                  <em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>2</sub></code></em></td><td align="left">Join</td><td align="left">Join on relation</td></tr></tbody></table>
          </div></div><p><br class="table-break"></p>

        <p>Most of these operators are described in detail in <a class="xref" href="ch01s07.html" title="Built-in Operators and Library Functions">the section called &ldquo;Built-in Operators and Library Functions&rdquo;</a> for specific types. Here we describe the
        remaining generic operators.</p>

        <p title="Field Selection and Field Assignment">
          <b>Field Selection and Field Assignment.&nbsp;</b>

          Field selection and field assignment apply to all values that
          have named components like tuples and relations with named elements,
          data types, and locations. Field selection returns the value of the
          named component and Field assignment returns a new value in which
          the named component has been replaced by a new value. We illustrate
          this for tuples:</p><pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>tuple[int key, str val] T = &lt;1, "abc"&gt;;</code></strong>
<code class="computeroutput">tuple[int, str] : &lt;1, "abc"&gt;</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>T.val;</code></strong>
<code class="computeroutput">str : "abc"</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>T[val = "def"];</code></strong>
<code class="computeroutput">tuple[int, str] : &lt;1, "def"&gt;</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>T;</code></strong>
<code class="computeroutput">tuple[int, str] : &lt;1, "abc"&gt;</code></pre><p title="Field Selection and Field Assignment">
        </p>

        <p>Observe that field assignment creates a <span class="emphasis"><em>new</em></span>
        value with an updated field. The old value remains unchanged as can be
        seen from the unchanged value of <code class="literal">T</code> in the above
        example. In<a class="xref" href="ch01s06.html#section.assignment" title="Assignment Statement">the section called &ldquo;Assignment Statement&rdquo;</a> we explain how to
        change a field of variable value.</p>

        <p title="Field projection">
          <b>Field projection.&nbsp;</b>

          Field projection applies to tuples and relations and may
          contain element names or integer constants that refer to elements in
          the order in which they occur in the original value (counting from
          0). A field projection returns a new value that consists of the
          selected elements. Suppose we have a relation with traffic
          information that records the name of the day, the day number, and
          the length of the traffic jams at that day.
        </p>

        <pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>rel[str day, int daynum, int length] Traffic = 
        {&lt;"mon", 1, 100&gt;, &lt;"tue", 2, 150&gt;, &lt;"wed", 3, 125&gt;, 
         &lt;"thur", 4, 110&gt;, &lt;"fri", 5, 90&gt;};</code></strong>
<code class="computeroutput">rel[str, int, int]: {&lt;"thur",4,110&gt;,&lt;"tue",2,150&gt;,&lt;"wed",3,125&gt;,
         &lt;"fri",5,90&gt;,&lt;"mon",1,100&gt;}</code>

<strong class="userinput"><code><code class="prompt">rascal&gt;</code> </code></strong>Traffic&lt;length,daynum&gt;;
<code class="computeroutput">rel[int, int]: {&lt;110,4&gt;,&lt;150,2&gt;,&lt;90,5&gt;,&lt;100,1&gt;,&lt;125,3&gt;}
</code>
<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>Traffic&lt;2,day&gt;;</code></strong>
<code class="computeroutput">rel[int, str]: {&lt;125,"wed"&gt;,&lt;110,"thur"&gt;,&lt;100,"mon"&gt;,&lt;90,"fri"&gt;,
                &lt;150,"tue"&gt;}</code></pre>

        <p>Field projection thus selects parts from a larger value that has
        a fixed number of parts. The selection is based on position and not on
        value and can be used to completely reorder or remove the parts of a
        larger value.</p>

        <p title="Subscription">
          <b>Subscription.&nbsp;</b>

          Subscription selects values with a given computed index from a
          larger value that has a variable number of elements. For lists and
          tuples a single integer expression is allowed as index and the
          returned value is the element with that index (counting from 0). For
          maps, the index type should correspond to the key type of the map
          and the value associated with the index is returned. For relations,
          more than one index expression is allowed and as value a new,
          reduced, relation is returned with all elements that contained the
          index values at the corresponding tuples positions (but these values
          are removed, hence a reduced relation). Some examples illustrate
          this:</p><pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>L = [10, 20, 30];</code></strong>
<code class="computeroutput">list[int] : [10,20,30]
</code>
<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>L[1];</code></strong>
<code class="computeroutput">int : 20</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>T = &lt;"mon", 1&gt;;</code></strong>
<code class="computeroutput">tuple[str,int] : &lt;"mon", 1&gt;;</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>T[0];</code></strong>
<code class="computeroutput">str : "mon"</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>colors = ("hearts":"red", "clover":"black", 
                  "trumps":"black", "clubs":"red");</code></strong>
<code class="computeroutput">map[str,str] : ("hearts":"red", "clover":"black", 
                "trumps":"black", "clubs":"red")
</code>
<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>colors["trumps"];</code></strong>
<code class="computeroutput">str: "black"</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>colors[0];</code></strong>
<code class="computeroutput">Static Error: -:1,0: Expected str, but got int</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>colors["square"];</code></strong>
<code class="computeroutput">Uncaught Rascal Exception: -:1,0: NoSuchKey("square")</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>rel[str country, int year, int amount] GDP =
           {&lt;"US", 2008, 14264600&gt;, &lt;"EU", 2008, 18394115&gt;,
            &lt;"Japan", 2008, 4923761&gt;, &lt;"US", 2007, 13811200&gt;, 
            &lt;"EU", 2007, 13811200&gt;, &lt;"Japan", 2007, 4376705&gt;};</code></strong>
<code class="computeroutput">rel[str,int,int] : 
           {&lt;"US", 2008, 14264600&gt;, &lt;"EU", 2008, 18394115&gt;, 
            &lt;"Japan", 2008, 4923761&gt;, &lt;"US", 2007, 13811200&gt;, 
            &lt;"EU", 2007, 13811200&gt;, &lt;"Japan", 2007, 4376705&gt;}</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>GDP["Japan"];</code></strong>
<code class="computeroutput">rel[int,int] : {&lt;2008, 4923761&gt;, &lt;2007, 4376705&gt;}</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>GDP["Japan", 2008];</code></strong>
<code class="computeroutput">set[int] : {4923761}</code></pre><p title="Subscription">
        </p>

        <p title="Other Non-Boolean Operator Expressions">
          <b>Other Non-Boolean Operator Expressions.&nbsp;</b>

          The other non-Boolean operator expressions are explained in
          more detail for each datatype, see <a class="xref" href="ch01s07.html" title="Built-in Operators and Library Functions">the section called &ldquo;Built-in Operators and Library Functions&rdquo;</a>.
        </p>
      </div>

      <div class="section" title="Boolean Operator Expressions"><div class="titlepage"><div><div><h4 class="title"><a name="section.expressions-boolean"></a>Boolean Operator Expressions</h4></div></div></div>
        

        <p>The Boolean operators are summarized in <a class="xref" href="ch01s06.html#table.boolean-operators" title="Table&nbsp;1.3.&nbsp;Boolean Operators">Table&nbsp;1.3, &ldquo;Boolean Operators&rdquo;</a>. All operators are highly
        overloaded and we refer to <a class="xref" href="ch01s07.html" title="Built-in Operators and Library Functions">the section called &ldquo;Built-in Operators and Library Functions&rdquo;</a> for a
        description of their meaning for each specific type. Most operator are
        self-explanatory except the Match and NoMatch operators that are also
        the main reason to treat Boolean operator expressions separately.
        Although we describe patterns in full detail in <a class="xref" href="ch01s06.html#section.pattern" title="Patterns">the section called &ldquo;Patterns&rdquo;</a>, a preview is useful here. A pattern
        can</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>match (or not match) any arbitrary value (that we will call
            the <span class="emphasis"><em>subject value</em></span>);</p>
          </li><li class="listitem">
            <p>during the match variables may be bound to subvalues of the
            subject value.</p>
          </li></ul></div>

        <p title="Match Operator">
          <b>Match Operator.&nbsp;</b>

          The match operator
        </p>

        <pre class="programlisting"><em class="replaceable"><code>Pat</code></em> <code class="literal">:=</code> <em class="replaceable"><code>Exp</code></em></pre>

        <p>is evaluated as follows:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><span class="emphasis"><em>Exp</em></span> is evaluated, the result is a
            subject value;</p>
          </li><li class="listitem">
            <p>the subject value is matched against the pattern
            <span class="emphasis"><em>pat</em></span>;</p>
          </li><li class="listitem">
            <p>if the match succeeds, any variables in the pattern are
            bound to subvalues of the subject value and the match expression
            yields <code class="literal">true</code>;</p>
          </li><li class="listitem">
            <p>if the match fails, no variables are bound and the match
            expression yields <code class="literal">false</code>.</p>
          </li></ul></div>

        <p>This looks and <span class="emphasis"><em>is</em></span> nice and dandy, so why
        all this fuss about Boolean operators? The catch is that--as we will
        see in detail in <a class="xref" href="ch01s06.html#section.pattern" title="Patterns">the section called &ldquo;Patterns&rdquo;</a>--a match need not
        be unique. This means that there may be more than one way of matching
        the subject value resulting in different variable bindings. A quick
        example. Consider the following match of a list</p><pre class="programlisting">[1, list[int] <em class="replaceable"><code>L</code></em>, 2, list[int] <em class="replaceable"><code>M</code></em>] := [1,2,3,2,4]</pre>

        <p>By definition <code class="literal">list[int] L </code>and
        <code class="literal">list[int] M</code> match list elements that are part of
        the enclosing list in which they occur. If they should match a nested
        list each should be enclosed in list brackets.</p>

        <p>There are two solutions for the above match:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="literal">L = []</code> and <code class="literal">M = [2, 3, 2,
            4]</code>; and</p>
          </li><li class="listitem">
            <p><code class="literal">L = [2,3]</code> and <code class="literal">M =
            [4]</code>.</p>
          </li></ul></div>

        <p>Depending on the context, only the first solution of a match
        expression is used, respectively all solutions are used. If a match
        expression occurs in a larger Boolean expression, a subsequent
        subexpression may yield false and -- depending on the actual operator
        -- evaluation <span class="emphasis"><em>backtracks</em></span> to a previously
        evaluated match operator to try a next solution. Let's illustrate this
        by extending the above example:</p><pre class="programlisting">[1, list[int] <em class="replaceable"><code>L</code></em>, 2, list[int] <em class="replaceable"><code>M</code></em>] := [1,2,3,2,4] &amp;&amp; size(L) &gt; 0</pre><p>where
        we are looking for a solution in which <code class="literal">L</code> has a
        non-empty list as value. Evaluation proceeds as follows:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>The left argument of the <code class="literal">&amp;&amp;</code>
            operator is evaluated: the match expression is evaluated resulting
            in the bindings <code class="literal">L = []</code> and <code class="literal">M = [2, 3,
            2, 4]</code>;</p>
          </li><li class="listitem">
            <p>The right argument of the <code class="literal">&amp;&amp;</code>
            operator is evaluated: <code class="literal">size(L) &gt; 0</code> yields
            false;</p>
          </li><li class="listitem">
            <p>Backtrack to the left argument of the &amp;&amp; operator to
            check for more solutions: indeed there are more solutions
            resulting in the bindings <code class="literal">L = [2,3]</code> and
            <code class="literal">M = [4]</code>;</p>
          </li><li class="listitem">
            <p>Proceed to the right operator of
            <code class="literal">&amp;&amp;</code>: this time <code class="literal">size(L) &gt;
            0</code> yields <code class="literal">true</code>;</p>
          </li><li class="listitem">
            <p>The result of evaluating the complete expression is
            <code class="literal">true</code>.</p>
          </li></ul></div>

        <p>This behaviour is applicable in the context of the following
        Rascal constructs:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>Comprehensions, see <a class="xref" href="ch01s06.html#section.comprehension" title="Comprehension Expression">the section called &ldquo;Comprehension Expression&rdquo;</a>.</p>
          </li><li class="listitem">
            <p>Tests in for, one, all statements, see <a class="xref" href="ch01s06.html#section.statements" title="Statements">the section called &ldquo;Statements&rdquo;</a>.</p>
          </li></ul></div>

        <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
          <p>Make the above more specific.</p>
        </div>

        <div class="table"><a name="table.boolean-operators"></a><p class="title"><b>Table&nbsp;1.3.&nbsp;Boolean Operators</b></p><div class="table-contents">
            

            <table summary="Boolean Operators" border="1"><colgroup><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th align="left">Operator</th><th align="left">Name</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code class="literal">!</code>
                  <em class="replaceable"><code>Exp</code></em></td><td align="left">Negation</td><td align="left">Negate <em class="replaceable"><code>Exp</code></em>'s boolean
                  value</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em>
                  <code class="literal">?</code></td><td align="left">IsDefined</td><td align="left">true if <em class="replaceable"><code>Exp</code></em> has a
                  well-defined value, i.e., is the result of expression
                  evaluation that ended without raising an exception</td></tr><tr><td align="left"><em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>1</sub></code></em>
                  <code class="literal">in</code>
                  <em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>2</sub></code></em></td><td align="left">ElementOf</td><td align="left">Element of</td></tr><tr><td align="left"><em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>1</sub></code></em>
                  <code class="literal">notin</code>
                  <em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>2</sub></code></em></td><td align="left">NotElementOf</td><td align="left">Not element of</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">&lt;=</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">LessThanOrEqual</td><td align="left">Less than or equal on bool, int, real or string;
                  sublist on list; subset on set, map or relation</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">&lt;</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">LessThan</td><td align="left">Less than on bool, int, real or string; strict
                  sublist on list; strict subset on set, map or
                  relation</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">&gt;=</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">GreaterThanOrEqual</td><td align="left">Greater than or equal on bool, int, real or string;
                  superlist on list; superset on set, map or relation</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">&gt;</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">GreaterThan</td><td align="left">Greater than on bool, int, real or string; strict
                  superlist on list; strict superset on set, map or
                  relation</td></tr><tr><td align="left"><em class="replaceable"><code>Pat</code></em> <code class="literal">:=</code>
                  <em class="replaceable"><code>Exp</code></em></td><td align="left">Match</td><td align="left">Value of <em class="replaceable"><code>Exp</code></em> matches with
                  pattern <em class="replaceable"><code>Pat</code></em></td></tr><tr><td align="left"><em class="replaceable"><code>Pat</code></em> <code class="literal">!:=</code>
                  <em class="replaceable"><code>Exp</code></em></td><td align="left">NoMatch</td><td align="left">Value of <em class="replaceable"><code>Exp</code></em> does not
                  match with pattern <em class="replaceable"><code>Pat</code></em></td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">==</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">Equal</td><td align="left">Equality</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">!=</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">NotEqual</td><td align="left">Inequality</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">?</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">IfDefinedElse</td><td align="left">The value of
                  <em class="replaceable"><code>Exp</code></em><sub>1</sub> if
                  that is defined (i.e., is the result of expression
                  evaluation that ended without raising an exception thus
                  excluding, for instance, uninitialized variables and
                  undefined map elements) otherwise the value of
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">?</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub>
                  <code class="literal">:</code>
                  <em class="replaceable"><code>Exp</code></em><sub>3</sub></td><td align="left">IfThenElse</td><td align="left">Conditional expression</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">==&gt;</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">Implication</td><td align="left"><code class="literal">true</code>, unless the value of
                  <em class="replaceable"><code>Exp</code></em><sub>1</sub> is
                  <code class="literal">true</code> and that of
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub> is
                  <code class="literal">false</code></td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">&lt;==&gt;</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">Equivalence</td><td align="left">true if
                  <em class="replaceable"><code>Exp</code></em><sub>1</sub> and
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub> have
                  the same value</td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">&amp;&amp;</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">And</td><td align="left"><code class="literal">true</code> if the value of both
                  <em class="replaceable"><code>Exp</code></em><sub>1</sub> and
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub> is
                  <code class="literal">true</code></td></tr><tr><td align="left"><code class="literal"><em class="replaceable"><code>Exp</code></em><sub>1</sub>,
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub>,</code>
                  ...<code class="literal">,
                  <em class="replaceable"><code>Exp</code></em><sub>n</sub></code></td><td align="left">MultiCondition</td><td align="left"><code class="literal">Equivalent to:
                  <em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  &amp;&amp;
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub>
                  &amp;&amp;</code> ... <code class="literal">&amp;&amp;
                  <em class="replaceable"><code>Exp</code></em><sub>n</sub></code></td></tr><tr><td align="left"><em class="replaceable"><code>Exp</code></em><sub>1</sub>
                  <code class="literal">||</code>
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub></td><td align="left">Or</td><td align="left"><code class="literal">true</code> if the value of either
                  <em class="replaceable"><code>Exp</code></em><sub>1</sub> or
                  <em class="replaceable"><code>Exp</code></em><sub>2</sub> is
                  <code class="literal">true</code></td></tr><tr><td align="left"><code class="literal"><em class="replaceable"><code>Pat</code></em> &lt;-
                  <em class="replaceable"><code>Exp</code></em></code></td><td align="left">Enumerator</td><td align="left"><code class="literal">true</code> for every element in
                  <em class="replaceable"><code>Exp</code></em>'s value (set/list element,
                  direct subtree) that matches
                  <em class="replaceable"><code>Pat</code></em></td></tr></tbody></table>
          </div></div><p><br class="table-break"></p>
      </div>

      <div class="section" title="Patterns"><div class="titlepage"><div><div><h4 class="title"><a name="section.pattern"></a>Patterns</h4></div></div></div>
        

        <p>Patterns come in three flavours:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><span class="emphasis"><em>Regular expression patterns</em></span> to do
            string matching with regular expressions, see <a class="xref" href="ch01s06.html#section.regular-patterns" title="Regular Expression Patterns">the section called &ldquo;Regular Expression Patterns&rdquo;</a>.</p>
          </li><li class="listitem">
            <p><span class="emphasis"><em>Abstract patterns</em></span> to matching on
            arbitrary values, see <a class="xref" href="ch01s06.html#section.abstract-patterns" title="Abstract Patterns">the section called &ldquo;Abstract Patterns&rdquo;</a>.</p>
          </li><li class="listitem">
            <p><span class="emphasis"><em>Concrete syntax patterns</em></span> to match
            syntax trees that are the result of parsing, see <a class="xref" href="ch01s06.html#section.concrete-patterns" title="Concrete Syntax Patterns">the section called &ldquo;Concrete Syntax Patterns&rdquo;</a>.</p>
          </li></ul></div>

        <div class="section" title="Regular Expression Patterns"><div class="titlepage"><div><div><h5 class="title"><a name="section.regular-patterns"></a>Regular Expression Patterns</h5></div></div></div>
          

          <p>Regular expression patterns are ordinary regular expressions
          that are used to match a string value and to decompose it in parts
          and also to compose new strings. Regular expression patterns bind
          variables of type <code class="literal">str</code> when the match succeeds,
          otherwise they do not bind anything. Their syntax and semantics
          parallels abstract and concrete syntax patterns as much as possible.
          This means that they can occur in cases of <code class="literal">visit</code>
          and <code class="literal">switch</code> statements, on the left-hand side of
          the match operator (<code class="literal">:= or !:=</code>) and as declarator
          in enumerators.</p>

          <p>Here are some examples of regular expression
          patterns.</p><pre class="programlisting">/\brascal\b/i</pre><p>does a
          case-insensitive match (<code class="literal">i</code>) of the word rascal
          between word boundaries (<code class="literal">\b</code>). And</p><pre class="programlisting">/^.*?&lt;word:\w+&gt;&lt;rest:.*$&gt;/m</pre><p>does
          a multi-line match (<code class="literal">m</code>), matches the first
          consecutive word characters (<code class="literal">\w</code>) and assigns them
          to the variable <code class="literal">word</code>. The remainder of the string
          is assigned to the variable <code class="literal">rest</code>. Constructs of
          the form
          <code class="literal">&lt;<em class="replaceable"><code>Name</code></em>:<em class="replaceable"><code>Regex</code></em>&gt;</code>
          are called variable <span class="bold"><strong>introductions</strong></span>.
          They introduce a new variable for the duration of the regular
          expression match.</p>

          <p>Regular expressions may also contain <span class="bold"><strong>references</strong></span> to variables: their string value
          is used at the position of the variable reference. This can be used
          to define so-called <span class="bold"><strong>non-linear</strong></span>
          patterns. This example</p>

          <pre class="programlisting">/&lt;x:[a-z]+&gt;---&lt;x&gt;/</pre><p>matches
          strings like <code class="literal">abc---abc</code> that consist of two
          identical sequences of letters separated by three dashes. Variables
          that are referenced in a regular expression may also come from the
          context in which the regular expression occurs. For instance,</p>

          <pre class="programlisting">/&lt;x&gt;&lt;n&gt;/</pre><p>will use
          the current values of <code class="literal">x</code> and <code class="literal">n</code>
          as regular expression. For values <code class="literal">"abc"</code>,
          respectively, <code class="literal">3</code> this would be equivalent to the
          regular expression:</p>

          <pre class="programlisting">/abc3/</pre><p>Observe that context
          variables may be of arbitrary type and that their value is first
          converted to a string before it is inserted in the regular
          expression. This can be used in many ways. For instance, regular
          expressions may contain restrictions on the number of repetitions of
          an element: <code class="literal">/a{3}/</code> will match exactly three
          letters <code class="literal">a</code>. Also minimum and maximum number of
          occurrences can be defined. Here is how the repetition count can be
          inserted by a variable reference (where n is assumed to have an
          integer value):</p>

          <pre class="programlisting">/a{&lt;n&gt;}/</pre><p>Taking this
          example one step further, we can even write</p>

          <pre class="programlisting">/&lt;x:a{&lt;n&gt;}&gt;/</pre><p>in
          other words, we introduce variable <code class="literal">x</code> and its
          defining regular expression contains a reference to a context
          variable.</p>

          <p>We use a regular expression language that slightly
          extends/modifies the Java Regex language:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>Regular expression are delimited by <code class="literal">/</code>
              and <code class="literal">/</code> optionally followed by modifiers (see
              below).</p>
            </li><li class="listitem">
              <p>We allow variable introductions, syntax
              <code class="literal">&lt;<em class="replaceable"><code>Name</code></em>:<em class="replaceable"><code>Regex</code></em>&gt;</code>,
              which introduce a variable of type <code class="literal">str</code> named
              <em class="replaceable"><code>Name</code></em>. A variable introduction
              corresponds to a group in a Java regexp. Each variable that is
              introduced should be unique, but may be referenced more than
              once later in the regular expression.</p>
            </li><li class="listitem">
              <p>Java regular expressions allow optional groups, which may
              introduce null bindings. Since uninitialized variables are not
              allowed in Rascal, we limit the kinds of expressions one can
              write here by not allowing nesting of variable
              introductions.</p>
            </li><li class="listitem">
              <p>We allow variable references in a regular expression of
              the form:
              <code class="literal">&lt;<em class="replaceable"><code>Name</code></em>&gt;</code> which
              inserts the string value of <em class="replaceable"><code>Name</code></em> in
              the pattern. Name should have been introduced in the regular
              experession itself or in the context in which the regular
              expression occurs.</p>
            </li><li class="listitem">
              <p>Unlike Perl, Java uses the notation
              <code class="literal">(?<em class="replaceable"><code>Option</code></em>)</code> inside
              the regular expression to set matching options. We let these
              options follow the regular expression as a modifiers. The
              following modifiers are supported:</p>

              <div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
                  <p>multi-line matching (<code class="literal">?m</code>): the
                  anchors <code class="literal">^</code> and <code class="literal">$</code>
                  usually only match at the beginning and end of the subject
                  string. When this option is set they also match any begin or
                  end of line that is embedded in the subject string.</p>
                </li><li class="listitem">
                  <p>case-insensitive matching (<code class="literal">?i</code>):
                  match characters irrespective of their case.</p>
                </li><li class="listitem">
                  <p>single-line mode (<code class="literal">?s</code>): the .
                  expression does usually not match line terminators. When
                  single-line mode is set, it will match any character
                  including line terminators.</p>
                </li><li class="listitem">
                  <p>unix lines (<code class="literal">?d</code>): usually newlines
                  (<code class="literal">\n</code>), carriage return
                  (<code class="literal">\r</code>) and new line carriage return
                  (<code class="literal">\n\r</code>) sequences are all considered line
                  terminators. When this option is set, only newline is
                  considered to be a line terminator.</p>
                </li></ul></div>
            </li></ul></div>

          <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
              <p>Further discuss here:</p>

              <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                  <p>grouping versus variable introduction.</p>
                </li><li class="listitem">
                  <p>Quoting issues.</p>
                </li><li class="listitem">
                  <p>Multiple matches.</p>
                </li></ul></div>
            </div><p>For convenience, we summarize the most frequently used
          constructs in regular expressions in <a class="xref" href="ch01s06.html#table.regexp-syntax" title="Table&nbsp;1.4.&nbsp;Frequently used elements of Regular Expression Syntax">Table&nbsp;1.4, &ldquo;Frequently used elements of Regular Expression
              Syntax&rdquo;</a>.</p>

          <div class="table"><a name="table.regexp-syntax"></a><p class="title"><b>Table&nbsp;1.4.&nbsp;Frequently used elements of Regular Expression
              Syntax</b></p><div class="table-contents">
              

              <table summary="Frequently used elements of Regular Expression
              Syntax" border="1"><colgroup><col align="left"><col align="left"></colgroup><thead><tr><th align="left">Operator</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><em class="replaceable"><code>x</code></em></td><td align="left">The single character <em class="replaceable"><code>x</code></em>
                    as long as it is not a punctuation character with a
                    special meaning in the regular expression syntax</td></tr><tr><td align="left"><code class="literal">\<em class="replaceable"><code>p</code></em></code></td><td align="left">The punctuation character
                    <em class="replaceable"><code>p</code></em></td></tr><tr><td align="left"><code class="literal">\\</code></td><td align="left">The backslah character</td></tr><tr><td align="left"><code class="literal">\n</code></td><td align="left">Newline character</td></tr><tr><td align="left"><code class="literal">\t</code></td><td align="left">Tab character</td></tr><tr><td align="left"><code class="literal">[...]</code></td><td align="left">One of the characters between the brackets (also
                    known as <span class="bold"><strong>character
                    class</strong></span>). Character ranges and set operations on
                    character classes may be used.</td></tr><tr><td align="left"><code class="literal">[^...]</code></td><td align="left">Any one character not between the brackets.</td></tr><tr><td align="left"><code class="literal">[a-z0-9]</code></td><td align="left">Character range: character between a and z or 0 and
                    9.</td></tr><tr><td align="left"><code class="literal">\d</code></td><td align="left">Digit: <code class="literal">[0-9]</code></td></tr><tr><td align="left"><code class="literal">\D</code></td><td align="left">Non-digit: <code class="literal">[^0-9]</code></td></tr><tr><td align="left"><code class="literal">\s</code></td><td align="left">Whitespace</td></tr><tr><td align="left"><code class="literal">\S</code></td><td align="left">Anything but whitespace.</td></tr><tr><td align="left"><code class="literal">\w</code></td><td align="left">A word: <code class="literal">[a-zA-Z0-9_]</code></td></tr><tr><td align="left"><code class="literal">\W</code></td><td align="left">A non-word: <code class="literal">[^\w]</code></td></tr><tr><td align="left"><em class="replaceable"><code>xy</code></em></td><td align="left">Match <em class="replaceable"><code>x</code></em> followed by
                    <em class="replaceable"><code>y</code></em></td></tr><tr><td align="left"><code class="literal"><em class="replaceable"><code>x</code></em>|<em class="replaceable"><code>y</code></em></code></td><td align="left">Match <em class="replaceable"><code>x</code></em> or
                    <em class="replaceable"><code>y</code></em></td></tr><tr><td align="left"><code class="literal"><em class="replaceable"><code>x</code></em>?</code></td><td align="left">Optional occurrence of
                    <em class="replaceable"><code>x</code></em></td></tr><tr><td align="left"><code class="literal"><em class="replaceable"><code>x</code></em>*</code></td><td align="left">Zero or more occurrences of<em class="replaceable"><code>
                    x</code></em></td></tr><tr><td align="left"><code class="literal"><em class="replaceable"><code>x</code></em>+</code></td><td align="left">One or more occurrences of
                    <em class="replaceable"><code>x</code></em></td></tr><tr><td align="left"><code class="literal"><em class="replaceable"><code>x</code></em>{<em class="replaceable"><code>n</code></em>}</code></td><td align="left">Exactly <em class="replaceable"><code>n</code></em> occurrences of
                    <em class="replaceable"><code>x</code></em></td></tr><tr><td align="left"><code class="literal"><em class="replaceable"><code>x</code></em>{<em class="replaceable"><code>n</code></em>,}</code></td><td align="left"><em class="replaceable"><code>n</code></em> or more occurrences of
                    <em class="replaceable"><code>x</code></em></td></tr><tr><td align="left"><code class="literal"><em class="replaceable"><code>x</code></em>{<em class="replaceable"><code>n</code></em>,<em class="replaceable"><code>m</code></em>}</code></td><td align="left">At least <em class="replaceable"><code>n</code></em>, at most
                    <em class="replaceable"><code>m</code></em> occurrences of
                    <em class="replaceable"><code>x</code></em></td></tr><tr><td align="left"><code class="literal">^</code></td><td align="left">The beginning of the subject string</td></tr><tr><td align="left"><code class="literal">$</code></td><td align="left">The end of the input string</td></tr><tr><td align="left"><code class="literal">\b</code></td><td align="left">Word boundary: position between a word and a
                    non-word character</td></tr><tr><td align="left"><code class="literal">\B</code></td><td align="left">Non-word boundary: position that is a not a word
                    boundary</td></tr></tbody></table>
            </div></div><p><br class="table-break"></p>
        </div>

        <div class="section" title="Abstract Patterns"><div class="titlepage"><div><div><h5 class="title"><a name="section.abstract-patterns"></a>Abstract Patterns</h5></div></div></div>
          

          <p>An abstract pattern is recursively defined and may contain the
          following elements:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><span class="emphasis"><em>Literal</em></span> of one of the basic types
              <code class="literal">bool</code>, <code class="literal">int</code>,
              <code class="literal">real</code>, <code class="literal">str</code>, or
              <code class="literal">loc</code>. A literal pattern matches with a value
              that is identical to the literal.</p>
            </li><li class="listitem">
              <p>A <span class="emphasis"><em>variable declaration
              pattern</em></span></p><pre class="programlisting"><em class="replaceable"><code>Type</code></em> <em class="replaceable"><code>Var</code></em></pre>

              <p>A variable declaration introduces a new variable that
              matches any value of the given type. That value is assigned to
              <em class="replaceable"><code>Var</code></em> when the whole match
              succeeds.</p>
            </li><li class="listitem">
              <p>A <span class="emphasis"><em>multi-variable
              pattern</em></span></p><pre class="programlisting"><em class="replaceable"><code>Var*</code></em></pre><p>A
              multi-variable is an abbreviation for a variable declaration
              pattern. It can occur in a list pattern or set pattern and can
              match zero or more list or set elements.</p>
            </li><li class="listitem">
              <p>A <span class="emphasis"><em>variable pattern</em></span></p><pre class="programlisting"><em class="replaceable"><code>Var</code></em></pre>

              <p>A variable pattern can act in two roles:</p>

              <div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
                  <p>If <em class="replaceable"><code>Var</code></em> has already a
                  defined value then it matches with that value.</p>
                </li><li class="listitem">
                  <p>If Var has not been defined before (or it has been
                  declared but not initialized) then it matches any value.
                  That value is assigned to <em class="replaceable"><code>Var</code></em>.
                  <em><span class="remark">Explain scope.</span></em></p>
                </li></ul></div>
            </li><li class="listitem">
              <p>A <span class="emphasis"><em>list pattern</em></span></p><pre class="programlisting">[ <em class="replaceable"><code>Pat</code></em><sub>1</sub>, <em class="replaceable"><code>Pat</code></em><sub>2</sub>, ..., <em class="replaceable"><code>Pat</code></em><sub>n</sub> ]</pre>

              <p>A list pattern matches a list value, provided that
              <em class="replaceable"><code>Pat</code></em><sub>1</sub>,
              <em class="replaceable"><code>Pat</code></em><sub>2</sub>, ...,
              <em class="replaceable"><code>Pat</code></em><sub>n</sub> match the
              elements of that list in order. Two special cases exist when one
              of the patterns
              <em class="replaceable"><code>Pat</code></em><sub>i</sub> is</p>

              <div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
                  <p>a variable declaration pattern with a list type that
                  is identical to the type of the list that is being
                  matched.</p>
                </li><li class="listitem">
                  <p>a variable pattern, where the variable has been
                  declared, but not initialized, outside the pattern with a
                  list type that is identical to the type of the list that is
                  being matched.</p>
                </li></ul></div>

              <p>In both cases list matching is applied and the variable
              can match an arbitrary number of elements of the subject
              list.</p>
            </li><li class="listitem">
              <p>A <span class="emphasis"><em>set pattern</em></span></p><pre class="programlisting">{ <em class="replaceable"><code>Pat</code></em><sub>1</sub>, <em class="replaceable"><code>Pat</code></em><sub>2</sub>, ..., <em class="replaceable"><code>Pat</code></em><sub>n</sub> }</pre>

              <p>A set pattern matches a set value, provided that
              <em class="replaceable"><code>Pat</code></em><sub>1</sub>,
              <em class="replaceable"><code>Pat</code></em><sub>2</sub>, ...,
              <em class="replaceable"><code>Pat</code></em><sub>n</sub> match the
              elements of that set in any order. Completely analogous to list
              patterns, there are two special cases when one of the patterns
              <em class="replaceable"><code>Pat</code></em><sub>i</sub> is</p>

              <div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
                  <p>a variable declaration pattern with a set type that is
                  identical to the type of the set that is being
                  matched.</p>
                </li><li class="listitem">
                  <p>a variable pattern, where the variable has been
                  declared, but not initialized, outside the pattern with a
                  set type that is identical to the type of the set that is
                  being matched.</p>
                </li></ul></div>

              <p>In both cases set matching is applied and the variable can
              match an arbitrary number (in arbitrary order!) of elements of
              the subject set.</p>
            </li><li class="listitem">
              <p>A <span class="emphasis"><em>tuple pattern</em></span></p><pre class="programlisting">&lt; <em class="replaceable"><code>Pat</code></em><sub>1</sub>, <em class="replaceable"><code>Pat</code></em><sub>2</sub>, ..., <em class="replaceable"><code>Pat</code></em><sub>n</sub> &gt;</pre>

              <p>A tuple pattern matches a tuple value, provided that
              <em class="replaceable"><code>Pat</code></em><sub>1</sub>,
              <em class="replaceable"><code>Pat</code></em><sub>2</sub>, ...,
              <em class="replaceable"><code>Pat</code></em><sub>n</sub> match the
              elements of that tuple in order.</p>
            </li><li class="listitem">
              <p>A <span class="emphasis"><em>node pattern</em></span></p><pre class="programlisting"><em class="replaceable"><code>Name</code></em> ( <em class="replaceable"><code>Pat</code></em><sub>1</sub>, <em class="replaceable"><code>Pat</code></em><sub>2</sub>, ..., <em class="replaceable"><code>Pat</code></em><sub>n</sub> )</pre>

              <p>A node pattern matches a node value or a datatype value,
              provided that <em class="replaceable"><code>Name</code></em> matches with the
              constructor symbol of that value and
              <em class="replaceable"><code>Pat</code></em><sub>1</sub>,
              <em class="replaceable"><code>Pat</code></em><sub>2</sub>, ...,
              <em class="replaceable"><code>Pat</code></em><sub>n</sub> match the
              children of that value in order.</p>
            </li><li class="listitem">
              <p>A <span class="emphasis"><em>descendant pattern</em></span></p><pre class="programlisting"><em class="replaceable"><code>/ Pat</code></em></pre><p>performs
              a deep match of the pattern <em class="replaceable"><code>Pat</code></em>. In
              other words, it matches when any element of the subject at any
              depth matches <em class="replaceable"><code>Pat</code></em> and is used to
              match, for instance, tree nodes at an arbitrary distance from
              the root.</p>
            </li><li class="listitem">
              <p>A <span class="emphasis"><em>labelled pattern</em></span></p><pre class="programlisting"><em class="replaceable"><code>Var</code></em> <code class="literal">:</code> <em class="replaceable"><code>Pat</code></em></pre>

              <p>A labelled pattern matches the same values as
              <em class="replaceable"><code>Pat</code></em>, but has as side-effect that the
              matched value is assigned to
              <em class="replaceable"><code>Var</code></em>.</p>
            </li><li class="listitem">
              <p>A <span class="emphasis"><em>typed, labelled,
              pattern</em></span></p><pre class="programlisting"><em class="replaceable"><code>Type Var</code></em> <code class="literal">:</code> <em class="replaceable"><code>Pat</code></em></pre>

              <p>A typed, labelled, pattern matches when the subject value
              has type <em class="replaceable"><code>Type</code></em> and
              <em class="replaceable"><code>Pat</code></em> matches. The matched value is
              assigned to <em class="replaceable"><code>Var</code></em>.</p>
            </li><li class="listitem">
              <p>A <span class="emphasis"><em>type constrained
              pattern</em></span></p><pre class="programlisting"><code class="literal">[</code><em class="replaceable"><code>Type</code></em><code class="literal">]</code> <em class="replaceable"><code>Pat</code></em></pre>

              <p>matches provided that the subject has type
              <em class="replaceable"><code>Type</code></em> and
              <em class="replaceable"><code>Pat</code></em> matches.</p>
            </li></ul></div>

          <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            <p>Map patterns are currently not supported.</p>
          </div>
        </div>

        <div class="section" title="Concrete Syntax Patterns"><div class="titlepage"><div><div><h5 class="title"><a name="section.concrete-patterns"></a>Concrete Syntax Patterns</h5></div></div></div>
          

          <p>A <span class="emphasis"><em>concrete pattern</em></span> is a (possibly quoted)
          concrete syntax fragment that may contain variables. We want to
          cover the whole spectrum from maximally quoted patterns that can
          unambiguously describe <span class="bold"><strong>any</strong></span> syntax
          fragment to minimally quoted patterns as we are used to in ASF+SDF.
          A concrete pattern may have the following forms:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>A <span class="emphasis"><em>typed variable</em></span>
              <span class="emphasis"><em>pattern</em></span></p><pre class="programlisting"><em class="replaceable"><code>&lt;Type</code></em> <em class="replaceable"><code>Var&gt;</code></em></pre>
            </li><li class="listitem">
              <p>A <span class="emphasis"><em>variable pattern</em></span></p><pre class="programlisting"><em class="replaceable"><code>&lt;Var&gt;</code></em></pre>
            </li><li class="listitem">
              <p><span class="emphasis"><em>Quoted pattern</em></span></p><pre class="programlisting">[| <em class="replaceable"><code>Token</code></em><sub>1</sub><em class="replaceable"><code> Token</code></em><sub>2</sub> ... <em class="replaceable"><code>Token</code></em><sub>n</sub> |]</pre>

              <p>Inside a quoted pattern arbitrary lexical tokens may
              occur, but the characters <code class="literal">&lt;</code>,
              <code class="literal">&gt;</code> and <code class="literal">|</code> have to be
              escaped as <code class="literal">\&lt;</code>, <code class="literal">\&gt;</code>,
              <code class="literal">\|</code>. Quoted patterns may contain variable
              declaration patterns and variable patterns.</p>
            </li><li class="listitem">
              <p>A <span class="emphasis"><em>typed quoted pattern</em></span>
              </p><pre class="programlisting"><em class="replaceable"><code>Symbol</code></em> [| <em class="replaceable"><code>Token</code></em><sub>1</sub><em class="replaceable"><code> Token</code></em><sub>2</sub> ... <em class="replaceable"><code>Token</code></em><sub>n</sub> |]</pre><p>is
              a quoted pattern that is preceded by an SDF symbol to define its
              desired syntactic type.</p>
            </li><li class="listitem">
              <p>An <span class="emphasis"><em>unquoted pattern</em></span></p><pre class="programlisting"><em class="replaceable"><code>Token</code></em><sub>1</sub><em class="replaceable"><code> Token</code></em><sub>2</sub> ... <em class="replaceable"><code>Token</code></em><sub>n</sub></pre>

              <p>is a quoted pattern without the surrounding quotes.</p>
            </li><li class="listitem">
              <p>Inside syntax patterns, layout is ignored.</p>
            </li></ul></div>

          <p>Examples:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>Quoted syntax pattern with two pattern variable
              declarations:</p><pre class="programlisting">[| while &lt;EXP Exp&gt; do &lt;{STATEMENT ";"}* Stats&gt; od |]</pre>
            </li><li class="listitem">
              <p>Quoted syntax pattern with two pattern variable
              uses:</p><pre class="programlisting">[| while &lt;Exp&gt; do &lt;Stats&gt; od |]</pre>
            </li><li class="listitem">
              <p>Identical to the previous example, but with a declaration
              of the desired syntactic type:</p><pre class="programlisting">STATEMENT [| while &lt;Exp&gt; do &lt;Stats&gt; od |]</pre>
            </li><li class="listitem">
              <p>Unquoted syntax pattern with two pattern variable
              declarations:</p><pre class="programlisting">while &lt;EXP Exp&gt; do &lt;{STATEMENT ";"}* Stats&gt; od</pre>
            </li><li class="listitem">
              <p>Unquoted syntax pattern with two pattern variable
              uses:</p><pre class="programlisting">while &lt;Exp&gt; do &lt;Stats&gt; od</pre>
            </li></ul></div>

          <p>Obviously, with less quoting and type information, the
          probability of ambiguities increases. Our assumption is that a type
          checker can resolve most of them.</p>
        </div>
      </div>

      <div class="section" title="PatternWithAction"><div class="titlepage"><div><div><h4 class="title"><a name="section.pattern-with-action"></a>PatternWithAction</h4></div></div></div>
        

        <p>Patterns can be used in various contexts, but a common context
        is a <em class="replaceable"><code>PatternWithAction</code></em>, which in its turn,
        may be used in a visit expression (see <a class="xref" href="ch01s06.html#section.visit" title="Visit expression">the section called &ldquo;Visit expression&rdquo;</a>), a switch statement (see <a class="xref" href="ch01s06.html#section.switch" title="Switch Statement">the section called &ldquo;Switch Statement&rdquo;</a>), or a rewrite rule (see <a class="xref" href="ch01s06.html#section.rewrite-rule" title="Rewrite Rule Declaration">the section called &ldquo;Rewrite Rule Declaration&rdquo;</a>).</p>

        <p>A <em class="replaceable"><code>PatternWithAction </code></em>can have one of
        the following forms:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <pre class="programlisting"><code class="literal"><em class="replaceable"><code>Pat</code></em> =&gt; <em class="replaceable"><code>Exp</code></em></code></pre><p>When
            the subject matches <em class="replaceable"><code>Pat</code></em>, the expression
            <em class="replaceable"><code>Exp</code></em> is evaluated. The use of the
            resulting value depends on the context and is described in the
            relevant section.</p>
          </li><li class="listitem">
            <pre class="programlisting"><em class="replaceable"><code>Pat</code></em> : <em class="replaceable"><code>Statement</code></em></pre>

            <p>This is the most general case. When the subject matches
            <em class="replaceable"><code>Pat</code></em>, the
            <em class="replaceable"><code>Statement</code></em> is executed. The execution of
            <em class="replaceable"><code>Statement</code></em> should, depending on the
            context, lead to one of the following:</p>

            <div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
                <p>Execution of a <code class="literal">return</code> statement that
                returns a value from the enclosing function.</p>
              </li><li class="listitem">
                <p>Execution of a <code class="literal">fail</code> statement: all
                side effects of <em class="replaceable"><code>Statement</code></em> are
                undone and the PatternWithAction as a whole fails.</p>
              </li><li class="listitem">
                <p>None of the above: execution continues with the
                statement following the switch.</p>
              </li></ul></div>
          </li></ul></div>
      </div>

      <div class="section" title="Comprehension Expression"><div class="titlepage"><div><div><h4 class="title"><a name="section.comprehension"></a>Comprehension Expression</h4></div></div></div>
        

        <p>We will use the familiar notation for <span class="emphasis"><em>list
        comprehension</em></span></p><pre class="programlisting">[<em class="replaceable"><code>Exp</code></em><sub>1</sub>, ..., <em class="replaceable"><code>Exp</code></em><sub><em class="replaceable"><code>n</code></em></sub> | <em class="replaceable"><code>Gen</code></em><sub>1</sub>, ..., <em class="replaceable"><code>Gen</code></em><sub><em class="replaceable"><code>m</code></em></sub>]</pre>

        <p>to denote the construction of a list consisting of the
        successive values of the <span class="emphasis"><em>contributing expressions</em></span>
        <em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>1</sub>,
        ...,
        <em class="replaceable"><code>Exp</code></em><sub><em class="replaceable"><code>n</code></em></sub></code></em>.
        The values and the resulting list are determined by
        <em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>1</sub>,
        ...,
        <em class="replaceable"><code>Exp</code></em><sub><em class="replaceable"><code>n</code></em></sub></code></em>
        and the <span class="emphasis"><em>generators</em></span>
        <em class="replaceable"><code>Gen</code></em><sub>1</sub> ,...,
        <em class="replaceable"><code>Gen</code></em><sub><em class="replaceable"><code>m</code></em></sub>.
        <em class="replaceable"><code>Exp</code></em><sub>1</sub>, ...,
        <em class="replaceable"><code>Exp</code></em><sub><em class="replaceable"><code>n</code></em></sub>
        are computed for all possible combinations of values produced by the
        generators. Each generator may introduce new variables that can be
        used in subsequent generators as well as in the expressions. A
        generator can use the variables introduced by preceding generators.
        Generators may enumerate all the values in a set or relation, or they
        may perform an arbitrary test.</p>

        <p>In addition to list comprehensions, Rascal also supports
        <span class="emphasis"><em>set comprehension</em></span></p><pre class="programlisting">{<em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>1</sub>, ..., <em class="replaceable"><code>Exp</code></em><sub><em class="replaceable"><code>n</code></em></sub></code></em> | <em class="replaceable"><code>Gen</code></em><sub>1</sub>, ..., <em class="replaceable"><code>Gen</code></em><sub><em class="replaceable"><code>m</code></em></sub>}</pre>

        <p>that also serve as relation comprehension in the case that
        <em class="replaceable"><code>Exp</code></em> is of a tuple type.</p>

        <p>Finally, <em class="replaceable"><code>map comprehension</code></em>s are
        written as:</p>

        <pre class="programlisting">(<em class="replaceable"><code>Exp</code></em><sub>1</sub> : <em class="replaceable"><code>Exp</code></em><sub>2</sub> | <em class="replaceable"><code>Gen</code></em><sub>1</sub>, ..., <em class="replaceable"><code>Gen</code></em><sub><em class="replaceable"><code>m</code></em></sub>)</pre>

        <p>Since the entries in a map require both a key and a value for
        each entry, two expressions are needed in this case.</p>

        <div class="section" title="Enumerator"><div class="titlepage"><div><div><h5 class="title"><a name="N228FB"></a>Enumerator</h5></div></div></div>
          

          <p>An enumerator generates all the values in a given list, set,
          map, tuple, relation or datatype. It has the following
          form:</p><pre class="programlisting"><em class="replaceable"><code>Pat</code></em> &lt;- <em class="replaceable"><code>Exp</code></em></pre>

          <p>where <em class="replaceable"><code>Pat</code></em> is a pattern and
          <em class="replaceable"><code>Exp</code></em> is an expression. An enumerator is
          evaluated as follows:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>Expression <em class="replaceable"><code>Exp</code></em> is evaluated and
              may have an arbitrary value <em class="replaceable"><code>V</code></em>.</p>
            </li><li class="listitem">
              <p>The elements of <em class="replaceable"><code>V</code></em> are
              enumerated one by one.</p>
            </li><li class="listitem">
              <p>Each element value is matched against the pattern
              <em class="replaceable"><code>Pat</code></em>. There are two cases:</p>

              <div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
                  <p>The match succeeds, any variables in
                  <em class="replaceable"><code>Pat</code></em> are bound, and the next
                  generator in the comprehension is evaluated. The variables
                  that are introduced by an enumerator are only available to
                  generators that appear later (i.e., to the right) in the
                  comprehension. When this enumerator is the last generator in
                  the comprehension its contributing expression is
                  evaluated.</p>
                </li><li class="listitem">
                  <p>The match fails, no variables are bound. If V has more
                  elements, a next element is tried. Otherwise, a previous
                  generator (i.e., to the left) is tried. If this enumerator
                  is the first generator in the comprehension, the evaluation
                  of the comprehension is complete.</p>
                </li></ul></div>
            </li></ul></div>

          <p>This are examples of enumerators:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><code class="literal">int N &lt;- {1, 2, 3, 4, 5}</code>,</p>
            </li><li class="listitem">
              <p><code class="literal">str K &lt;- KEYWORDS</code>, where
              <code class="literal">KEYWORDS</code> should evaluate to a value of
              <code class="literal">set[str]</code>.</p>
            </li><li class="listitem">
              <p><code class="literal">&lt;str K, int N&gt; &lt;- {&lt;"a",10&gt;,
              &lt;"b",20&gt;, &lt;"c",30&gt;}</code>.</p>
            </li><li class="listitem">
              <p><code class="literal">&lt;str K, int N&gt; &lt;- FREQUENCIES</code>,
              where <code class="literal">FREQUENCIES</code> should evaluate to a value
              of type <code class="literal">rel[str,int]</code>.</p>
            </li><li class="listitem">
              <p><code class="literal">&lt;str K, 10&gt; &lt;- FREQUENCIES</code>,
              will only generate pairs with <code class="literal">10</code> as second
              element.</p>
            </li></ul></div>

          <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
              <p>Type information will be used to check the plausibility of
              an enumerator and guard you against mistakes. An impossible
              enumerator like <code class="literal">int N &lt;- {"apples",
              "oranges"}</code> will be flagged as an error since the
              pattern can never match.</p>
            </div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
              <p>An enumerator may be preceded by a <span class="emphasis"><em>strategy
              indication</em></span>:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                    <p><code class="literal">top-down</code></p>
                  </li><li class="listitem">
                    <p><code class="literal">bottom-up</code> (this is the
                    default)</p>
                  </li></ul></div>

              <p>These take only effect for enumerators that produce the
              elements of a data type and determine the order in which the
              elements are enumerated.</p>
            </div>
        </div>

        <div class="section" title="Test"><div class="titlepage"><div><div><h5 class="title"><a name="N229A9"></a>Test</h5></div></div></div>
          

          <p>A test is a boolean-valued expression. If the evaluation
          yields <code class="literal">true</code> this indicates that the current
          combination of generated values up to this test is still as desired
          and execution continues with subsequent generators. If the
          evaluation yields <code class="literal">false</code> this indicates that the
          current combination of values is undesired, and that another
          combination should be tried by going back to the previous
          generator.</p>

          <p>Examples:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><code class="literal">N &gt;= 3</code> tests whether
              <code class="literal">N</code> has a value greater than or equal
              <code class="literal">3</code>.</p>
            </li><li class="listitem">
              <p><code class="literal">S == "coffee"</code> tests whether
              <code class="literal">S</code> is equal to the string
              <code class="literal">"coffee"</code>.</p>
            </li></ul></div>

          <p>In both examples, the variable (<code class="literal">N</code>,
          respectively, <code class="literal">S</code>) should have been introduced by a
          generator that occurs earlier in the comprehension.</p>
        </div>

        <div class="section" title="Examples of Comprehensions"><div class="titlepage"><div><div><h5 class="title"><a name="N229E3"></a>Examples of Comprehensions</h5></div></div></div>
          

          <p>Here are some examples of comprehensions:</p>

          <pre class="screen"><code class="literal">rascal&gt; </code><strong class="userinput"><code><code class="literal">{X | int X &lt;- {1, 2, 3, 4, 5}, X &gt;= 3}</code>;</code></strong>
<code class="computeroutput">set[int] : <code class="literal">{3,4,5}</code></code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>{&lt;X, Y&gt; | int X &lt;- {1, 2, 3}, int Y : {2, 3, 4}, X &gt;= Y};</code></strong>
<code class="computeroutput"><code class="literal">rel[int,int] : {&lt;2, 2&gt;, &lt;3, 2&gt;, &lt;3, 3&gt;}</code></code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>{&lt;Y, X&gt; | &lt;int X, int Y&gt; &lt;- {&lt;1,10&gt;, &lt;2,20&gt;}};</code></strong>
<code class="computeroutput">rel[int,int] : <code class="literal">{&lt;10,1&gt;, &lt;20,2&gt;}</code></code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>{X, X * X | int X &lt;- {1, 2, 3, 4, 5}, X &gt;= 3};</code></strong>
<code class="computeroutput">set[int] : <code class="literal">{3,4,5,9,16,25}</code></code></pre>
        </div>
      </div>

      <div class="section" title="Visit expression"><div class="titlepage"><div><div><h4 class="title"><a name="section.visit"></a>Visit expression</h4></div></div></div>
        

        <p>Visiting the nodes in a tree is a very common task in the EASY
        domain. In many cases (but certainly not all) the tree is a syntax
        tree of some source code file and the nodes correspond to expressions
        or statements. Computing metrics or refactoring are examples of tasks
        that require a tree visit. In object-oriented programming, the
        <span class="emphasis"><em>visitor pattern</em></span> is in common use for this. There
        are three frequently occurring scenarios:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>Accumulator: traverse the tree and collect
            information.</p>
          </li><li class="listitem">
            <p>Transformer: traverse the tree and transform it into another
            tree.</p>
          </li><li class="listitem">
            <p>Accumulating Transformer: traverse the tree, collect
            information and also transform the tree.</p>
          </li></ul></div>

        <p>The <code class="literal">visit</code> expression in Rascal can
        accommodate all these (and more) use cases and has the form:</p>

        <pre class="programlisting"><em class="replaceable"><code>Strategy</code></em> <span class="keysym">visit</span> ( <em class="replaceable"><code>Exp</code></em> ) {
<span class="keysym">case</span> <em class="replaceable"><code>PatternWithAction</code></em><sub>1</sub>;
<span class="keysym">case</span> <em class="replaceable"><code>PatternWithAction</code></em><sub>2</sub>;
...
<span class="keysym">default</span>: ...
}</pre>

        <p>Given a subject term (the current value of
        <em class="replaceable"><code>Exp</code></em>) and a list of cases (consisting of
        PatternWithActions, see <a class="xref" href="ch01s06.html#section.pattern-with-action" title="PatternWithAction">the section called &ldquo;PatternWithAction&rdquo;</a>) it traverses the term.
        Depending on the precise actions it may perform replacement (mimicking
        a transformer), update local variables (mimicking an accumulator) or a
        combination of these two (accumulating transformer). If <span class="bold"><strong>any</strong></span> of the actions contains an
        <code class="literal">insert</code> statement, the value of the visit expression
        is a new value that is obtained by successive insertions in the
        subject term by executing one or more cases. Otherwise, the original
        value of the subject term is returned.</p>

        <p>The visit expression is optionally preceded by one of the
        following strategy indications that determine the traversal order of
        the subject:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>top-down: visit the subject from root to leaves.</p>
          </li><li class="listitem">
            <p><code class="literal">top-down-break</code>: visit the subject from
            root to leaves, but stop at the current path when a case
            matches.</p>
          </li><li class="listitem">
            <p><code class="literal">bottom-up</code>: visit the subject from leaves
            to root (this is the default).</p>
          </li><li class="listitem">
            <p><code class="literal">bottom-up-break</code>: visit the subject from
            leaves to root, but stop at the current path when a case
            matches.</p>
          </li><li class="listitem">
            <p><code class="literal">innermost</code>: repeat a bottom-up traversal
            as long as the traversal changes the resulting value (compute a
            fixed-point).</p>
          </li><li class="listitem">
            <p><code class="literal">outermost</code>: repeat a top-down traversal as
            long as the traversal changes the resulting value (compute a
            fixed-point).</p>
          </li></ul></div>

        <p>The execution of the cases has the following effect:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>PatternWithActions of the form
            <em class="replaceable"><code>Pat</code></em> =&gt;
            <em class="replaceable"><code>Exp</code></em> insert their result in the
            subject.</p>
          </li><li class="listitem">
            <p>For PatternWithActions of the form
            <code class="literal"><em class="replaceable"><code>Pat</code></em> :
            <em class="replaceable"><code>Statement</code></em></code>, executing
            <em class="replaceable"><code>Statement</code></em> should lead to one of the
            following:</p>

            <div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
                <p>Execution of an <code class="literal">insert</code> statement of
                the form</p><pre class="programlisting"><span class="keysym">insert</span> <em class="replaceable"><code>Expr</code></em></pre><p>The
                value of <em class="replaceable"><code>Exp</code></em> replaces the subtree
                of the subject that is currently being visited. Note that a
                copy of the subject is created at the start of the visit
                statement and all insertions are made in this copy. As a
                consequence, insertions cannot influence matches later
                on.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    <p>An <code class="literal">insert</code> statement may only
                    occur inside a <code class="literal">visit</code> expression.</p>
                  </div>
              </li><li class="listitem">
                <p>Execution of a <code class="literal">fail</code> statement: all
                side effects of <em class="replaceable"><code>Statement</code></em> are
                undone, no insertion is made, and the next case is
                tried.</p>
              </li><li class="listitem">
                <p>Execution of a <code class="literal">return</code> statement that
                returns a value from the enclosing function.</p>
              </li></ul></div>
          </li></ul></div>

        <p>The precise behaviour of the visit expression depends on the
        type of the subject:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>For type <code class="literal">node or ADT</code>, all nodes of the
            tree are visited (in the order determined by the strategy).
            Concrete patterns and abstract patterns directly match tree nodes.
            Regular expression patterns match only values of type
            string.</p>
          </li><li class="listitem">
            <p>For structured types (list, set, map, tuple, rel), the
            elements of the structured type are visited and matched against
            the cases. When inserts are made, a new structured value is
            created.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
                <p>Have strategies any effect for non-tree subjects?</p>
              </div>
          </li></ul></div>
      </div>

      <div class="section" title="One Expression"><div class="titlepage"><div><div><h4 class="title"><a name="section.one"></a>One Expression</h4></div></div></div>
        

        <pre class="programlisting"><span class="keysym">one</span> <code class="literal">(</code> <code class="literal"><em class="replaceable"><code>Exp</code></em><sub>1</sub> , <em class="replaceable"><code>Exp</code></em><sub>2</sub> ,</code> ... <code class="literal">, <em class="replaceable"><code>Exp</code></em><sub>n</sub></code><code class="literal"> )</code></pre><p>The
        <span class="keysym">one</span> expression yields true when one combination of
        values of <em class="replaceable"><code>Exp</code></em><sub>i</sub> is
        true. <em><span class="remark">The status of one is under discussion.</span></em></p>
      </div>

      <div class="section" title="All Expression"><div class="titlepage"><div><div><h4 class="title"><a name="section.all"></a>All Expression</h4></div></div></div>
        

        <pre class="programlisting"><span class="keysym">all</span> <code class="literal">(</code> <code class="literal"><em class="replaceable"><code>Exp</code></em><sub>1</sub> , <em class="replaceable"><code>Exp</code></em><sub>2</sub> ,</code> ... <code class="literal">, <em class="replaceable"><code>Exp</code></em><sub>n</sub></code><code class="literal"> )</code> </pre><p>The
        all expression yields true when all combinations of values of
        <em class="replaceable"><code>Exp</code></em><sub>i</sub> are true.
        <em><span class="remark">The status of one is under discussion.</span></em></p>
      </div>
    </div>

    <div class="section" title="Statements"><div class="titlepage"><div><div><h3 class="title"><a name="section.statements"></a>Statements</h3></div></div></div>
      

      <div class="figure"><a name="figure.statement-parts"></a><p class="title"><b>Figure&nbsp;1.21.&nbsp;Various Statement Forms</b></p><div class="figure-contents">
          

          <div class="mediaobject"><img src="statement-parts.png" width="270" alt="Various Statement Forms"></div>
        </div></div><p><br class="figure-break">The various statements forms are summarized in <a class="xref" href="ch01s06.html#figure.statement-parts" title="Figure&nbsp;1.21.&nbsp;Various Statement Forms">Figure&nbsp;1.21, &ldquo;Various Statement Forms&rdquo;</a>. The more advanced statements are
      show in a different color.</p>

      <div class="section" title="If Statement"><div class="titlepage"><div><div><h4 class="title"><a name="N22B90"></a>If Statement</h4></div></div></div>
        

        <p>The if-statement is completely standard and comes in an if-then
        and an if-then-else variant:</p><pre class="programlisting"><span class="keysym">if</span> <code class="literal">( <em class="replaceable"><code>Bool</code></em> ) <em class="replaceable"><code>Statement</code></em></code></pre><pre class="programlisting"><span class="keysym">if</span><code class="literal"> ( <em class="replaceable"><code>Bool</code></em> ) <em class="replaceable"><code>Statement</code></em><sub>1</sub> </code><span class="keysym">else</span><code class="literal"> <em class="replaceable"><code>Statement</code></em><sub>2</sub></code></pre>

        <p>In both cases the test <em class="replaceable"><code>Bool</code></em> is
        evaluated and its outcome determines the statement to be executed.
        Recall from <a class="xref" href="ch01s06.html#section.expressions-boolean" title="Boolean Operator Expressions">the section called &ldquo;Boolean Operator Expressions&rdquo;</a> that
        boolean expression maybe multi-valued. In this case only the first
        true value (if any) is used.</p>
      </div>

      <div class="section" title="While Statement"><div class="titlepage"><div><div><h4 class="title"><a name="N22BC2"></a>While Statement</h4></div></div></div>
        

        <p>The while-statement is completely standard:</p><pre class="programlisting"><span class="keysym">while</span><code class="literal"> ( <em class="replaceable"><code>Bool</code></em> ) <em class="replaceable"><code>Statement</code></em></code></pre><p>The
        test <em class="replaceable"><code>Bool</code></em> is evaluated repeatedly and
        <em class="replaceable"><code>Statement</code></em> is executed when the test is
        true. Execution ends the first time that the test yields false. The
        test <em class="replaceable"><code>Bool</code></em> is executed anew in each
        repetition and only the first true value (if any) is used.</p>
      </div>

      <div class="section" title="Do Statement"><div class="titlepage"><div><div><h4 class="title"><a name="N22BDF"></a>Do Statement</h4></div></div></div>
        

        <p>The do-while-statement is completely standard:</p><pre class="programlisting"><span class="keysym">do</span> <em class="replaceable"><code>Statement</code></em> <span class="keysym">while</span> <code class="literal">( <em class="replaceable"><code>Bool</code></em> ) </code></pre><p>Statement
        is executed repeatedly, as long as the test Bool yields true. The test
        <em class="replaceable"><code>Bool</code></em> is executed anew in each repetition
        and only the first true value (if any) is used.</p>
      </div>

      <div class="section" title="For Statement"><div class="titlepage"><div><div><h4 class="title"><a name="N22BFB"></a>For Statement</h4></div></div></div>
        

        <p>The for-statement is more exciting:</p><pre class="programlisting"><span class="keysym">for</span> <code class="literal">(</code> <code class="literal"><em class="replaceable"><code>Exp</code></em><sub>1</sub> , <em class="replaceable"><code>Exp</code></em><sub>2</sub> ,</code> ... <code class="literal">, <em class="replaceable"><code>Exp</code></em><sub>n</sub></code><code class="literal"> )</code> <em class="replaceable"><code>Statement</code></em></pre><p>It
        executes <em class="replaceable"><code>Statement</code></em> for all possible
        combinations of values of the expressions
        <em class="replaceable"><code>Exp</code></em><sub>i</sub>. Note that if
        one of the expressions is a boolean expression, we do try all its
        possible values.</p>
      </div>

      <div class="section" title="Switch Statement"><div class="titlepage"><div><div><h4 class="title"><a name="section.switch"></a>Switch Statement</h4></div></div></div>
        

        <p>A <code class="literal">switch</code> statement is similar to a switch
        statement in C or Java and has the form:</p><pre class="programlisting">switch ( <em class="replaceable"><code>Exp</code></em> ) {
case <em class="replaceable"><code>PatternWithAction</code></em><sub>1</sub>;
case <em class="replaceable"><code>PatternWithAction</code></em><sub>2</sub>;
...
default: ...
}</pre>

        <p>The value of the expression <em class="replaceable"><code>Exp</code></em> is
        the subject term that will be matched by the successive
        PatternWithActions (see <a class="xref" href="ch01s06.html#section.pattern-with-action" title="PatternWithAction">the section called &ldquo;PatternWithAction&rdquo;</a>) in the switch statement. The
        switch statement provides <span class="bold"><strong>only</strong></span>
        matching at the top level of the subject term and does not traverse
        it. The type of the pattern in each case must be identical to the type
        of the subject term (or be a subtype of it). If no case matches, the
        switch acts as a dummy statement. There is no fall through from one
        case to the next.</p>
      </div>

      <div class="section" title="Assignment Statement"><div class="titlepage"><div><div><h4 class="title"><a name="section.assignment"></a>Assignment Statement</h4></div></div></div>
        

        <p>The purpose of an assignment is to assign a new value to a
        simple variable or to an element of a more complex data structure. The
        most general form of an assignment statement is</p>

        <pre class="programlisting"><em class="replaceable"><code>Assignable</code></em> <em class="replaceable"><code>AssignmentOp</code></em> <em class="replaceable"><code>Exp</code></em></pre><p>where
        <em class="replaceable"><code>AssignmentOp</code></em> may be <code class="literal">=</code>,
        <code class="literal">+=</code>, <code class="literal">-=</code>, <code class="literal">*=</code>,
        <code class="literal">/=</code>, or <code class="literal">?=</code>. Here = is the
        ordinary assignment operators and the other forms can be derived from
        it according to <a class="xref" href="ch01s06.html#table.assignment-operators" title="Table&nbsp;1.5.&nbsp;Assignment Operators">Table&nbsp;1.5, &ldquo;Assignment Operators&rdquo;</a>.</p><div class="table"><a name="table.assignment-operators"></a><p class="title"><b>Table&nbsp;1.5.&nbsp;Assignment Operators</b></p><div class="table-contents">
            

            <table summary="Assignment Operators" border="1"><colgroup><col align="left"><col align="left"></colgroup><thead><tr><th align="left">Assignment Operator</th><th align="left">Equivalent to</th></tr></thead><tbody><tr><td align="left"><em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">+=</code> <em class="replaceable"><code>Exp</code></em></td><td align="left"><em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">=</code> <em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">+</code> <em class="replaceable"><code>Exp</code></em></td></tr><tr><td align="left"><em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">-=</code> <em class="replaceable"><code>Exp</code></em></td><td align="left"><em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">=</code> <em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">-</code> <em class="replaceable"><code>Exp</code></em></td></tr><tr><td align="left"><em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">*=</code> <em class="replaceable"><code>Exp</code></em></td><td align="left"><em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">=</code> <em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">*</code> <em class="replaceable"><code>Exp</code></em></td></tr><tr><td align="left"><em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">/=</code> <em class="replaceable"><code>Exp</code></em></td><td align="left"><em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">=</code> <em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">/</code> <em class="replaceable"><code>Exp</code></em></td></tr><tr><td align="left"><em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">?=</code> <em class="replaceable"><code>Exp</code></em></td><td align="left"><em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">=</code> <em class="replaceable"><code>Assignable</code></em>
                  <code class="literal">?</code> <em class="replaceable"><code>Exp</code></em></td></tr></tbody></table>
          </div></div><p><br class="table-break"></p>

        <p>An assignable is either a single variable, (the <span class="emphasis"><em>base
        variable</em></span>), optionally followed by subscriptions or field
        selections. The assignment statement always results in assigning a
        <span class="emphasis"><em>completely new value</em></span> to the base variable. We
        distinguish the following forms of assignment:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <pre class="programlisting"><em class="replaceable"><code>Var</code></em> = <em class="replaceable"><code>Exp</code></em></pre><p>The
            expression <em class="replaceable"><code>Exp</code></em> is evaluated and its
            value is assigned to the base variable<em class="replaceable"><code>
            Var</code></em>.</p>
          </li><li class="listitem">
            <pre class="programlisting"><em class="replaceable"><code>Assignable</code></em> <code class="literal">[</code> <em class="replaceable"><code>Exp</code></em><sub>1</sub><code class="literal">] =</code> <em class="replaceable"><code>Exp</code></em><sub>2</sub></pre><p>First
            the value V of <em class="replaceable"><code>Assignable</code></em> is
            determined. Next the value of
            <em class="replaceable"><code>Exp</code></em><sub>1</sub>is used as
            index in <em class="replaceable"><code>V</code></em> and the value of
            <em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>2</sub></code></em>
            replaces the original value at that index position. The result is
            a new value <em class="replaceable"><code>V</code></em>' that is assigned to the
            <em class="replaceable"><code>Assignable</code></em>.</p>
          </li><li class="listitem">
            <pre class="programlisting"><em class="replaceable"><code>Assignable</code></em> <code class="literal">.</code> <em class="replaceable"><code>Name</code></em> = <em class="replaceable"><code>Exp</code></em></pre><p>The
            value V of <em class="replaceable"><code>Assignable</code></em> is determined and
            should be of a type that has a field Name. The value of that field
            is replaced in <em class="replaceable"><code>V</code></em> by the value of
            <em class="replaceable"><code>Exp</code></em> resulting in a new value V' that is
            assigned to Assignable.</p>
          </li><li class="listitem">
            <pre class="programlisting"><code class="literal">&lt;</code> <em class="replaceable"><code>Assignable</code></em><sub>1</sub><code class="literal">,</code> <em class="replaceable"><code>Assignable</code></em><sub>2</sub><code class="literal">,</code> ..., <em class="replaceable"><code>Assignable</code></em><sub>n</sub> <code class="literal">&gt; =</code> <em class="replaceable"><code>Exp</code></em></pre>

            <p>First the value <em class="replaceable"><code>Exp</code></em> is determined
            and should be a tuple of the form
            <code class="literal">&lt;</code><em class="replaceable"><code>V</code></em><sub>1</sub>,
            <em class="replaceable"><code>V</code></em><sub>2</sub>,
            ...,<em class="replaceable"><code>
            V</code></em><sub>n</sub><code class="literal">&gt;</code>.
            Next the assignments
            <em class="replaceable"><code>Assignable</code></em><sub>i</sub> =
            <em class="replaceable"><code>V</code></em><sub>i </sub>are performed
            for 1 &lt;= i &lt;= n.</p>
          </li><li class="listitem">
            <pre class="programlisting"><em class="replaceable"><code>Assignable</code></em> <code class="literal">?</code> <em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>1</sub></code></em> = <em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>2</sub></code></em></pre><p>First
            the value of
            <em class="replaceable"><code>Exp</code></em><sub>2</sub> is
            determined and if that is defined it is assigned to Assignable.
            Otherwise, the value of
            <em class="replaceable"><code><em class="replaceable"><code>Exp</code></em><sub>1</sub></code></em>is
            assigned to <em class="replaceable"><code>Assignable</code></em>.</p>
          </li><li class="listitem">
            <pre class="programlisting"><em class="replaceable"><code>Assignable</code></em> <code class="literal">@</code> <em class="replaceable"><code>Name</code></em> = <em class="replaceable"><code>Exp</code></em></pre><p>The
            value V of <em class="replaceable"><code>Assignable</code></em> is determined and
            should be of a type that has an annotation
            <em class="replaceable"><code>Name</code></em>. The value of that annotation is
            replaced in <em class="replaceable"><code>V</code></em> by the value of
            <em class="replaceable"><code>Exp</code></em> resulting in a new value V' that is
            assigned to <em class="replaceable"><code>Assignable</code></em>.</p>
          </li><li class="listitem">
            <pre class="programlisting"><code class="literal"><em class="replaceable"><code>Name</code></em> (</code> <em class="replaceable"><code>Assignable</code></em><sub>1</sub><code class="literal">,</code> <em class="replaceable"><code>Assignable</code></em><sub>2</sub><code class="literal">,</code> ... <code class="literal">) =</code> <em class="replaceable"><code>Exp</code></em></pre><p>First
            the value <em class="replaceable"><code>Exp</code></em> is determined and should
            be a data value of the form
            <code class="literal"><em class="replaceable"><code>Name</code></em>(</code><em class="replaceable"><code>V</code></em><sub>1</sub>,
            <em class="replaceable"><code>V</code></em><sub>2</sub>,
            ...,<em class="replaceable"><code>V</code></em><sub>n</sub><code class="literal">)</code>.
            Next the assignments
            <em class="replaceable"><code>Assignable</code></em><sub>i</sub> =
            <em class="replaceable"><code>V</code></em><sub>i</sub>are performed
            for 1 &lt;= i &lt;= n.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                <p>Constructor assignable is not yet implemented.</p>
              </div>
          </li></ul></div>

        <p>Here are some examples:</p><pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>N = 3;</code></strong>
<code class="computeroutput">int : 3</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>N;</code></strong>
<code class="computeroutput">int : 3</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>L = [10,20,30];</code></strong>
<code class="computeroutput">list[int] : [10,20,30]</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>P = L;</code></strong>
<code class="computeroutput">list[int] : [10,20,30]</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>L[1] = 200;</code></strong>
<code class="computeroutput">list[int] : [10,200,30]</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>P;</code></strong>  // Value of P is unchanged!
<code class="computeroutput">list[int] : [10,20,30]</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>M = ("abc": 1, "def" : 2);</code></strong>
<code class="computeroutput">map[str,int] : ("abc": 1, "def" : 2)</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>M["def"] = 3;</code></strong>
<code class="computeroutput">map[str,int] : ("abc": 1, "def" : 3)
</code>
<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>T = &lt;1, "abc", true&gt;;</code></strong>
<code class="computeroutput">tuple[int,str,bool] : &lt;1, "abc", true&gt;</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>T[1] = "def";</code></strong>
<code class="computeroutput">tuple[int,str,bool] : &lt;1, "def", true&gt;</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>data FREQ = wf(str word, int freq);</code></strong>
<code class="computeroutput">ok</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>W = wf("rascal", 1000);</code></strong>
<code class="computeroutput">FREQ : wf("rascal", 1000)
</code>
<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>W.freq = 100000;</code></strong>
<code class="computeroutput">FREQ : wf("rascal",100000)</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>&lt;A, B, C&gt; = &lt;"abc", 2.5, [1,2,3]&gt;;</code></strong>
<code class="computeroutput">tuple[str,real,list[int]] : &lt;"abc", 2.5, [1,2,3]&gt;</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>A;</code></strong>
<code class="computeroutput">str : "abc"</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>B;</code></strong>
<code class="computeroutput">real : 2.5</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>C;</code></strong>
<code class="computeroutput">list[int] : [1,2,3]</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>** good V ? E1 = E2 example here **</code></strong>


<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>anno str FREQ@color;</code></strong>
<code class="computeroutput">ok</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>W @ color = "red";</code></strong>
<code class="computeroutput">FREQ: wf("rascal",100000)[@color="red"]</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>wf(S, I) = W;</code></strong>
<code class="computeroutput">ok</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>S;</code></strong>
<code class="computeroutput">str : "rascal"</code>

<code class="prompt">rascal&gt;</code> <strong class="userinput"><code>I;</code></strong>
<code class="computeroutput">int : 100000</code></pre>
      </div>

      <div class="section" title="Return Statement"><div class="titlepage"><div><div><h4 class="title"><a name="section.return"></a>Return Statement</h4></div></div></div>
        

        <p>A return statement has either the form</p><pre class="programlisting"><span class="keysym">return</span>;</pre><p>or</p><pre class="programlisting"><span class="keysym">return</span> <em class="replaceable"><code>Exp</code></em>;</pre>

        <p>both end the execution of the current function. The first form
        applies to functions with <code class="literal">void</code> as return type. The
        second form applies to non-void functions and returns the value of
        <em class="replaceable"><code>Exp</code></em> as result of the function. The
        following rules apply:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>The static type of <em class="replaceable"><code>Exp</code></em> should be
            compatible with the declared return type of the function in which
            the return statement occurs.</p>
          </li><li class="listitem">
            <p>In each function with a return type that is not
            <code class="literal">void</code>, every possible execution path through the
            body of the function end in a return statement.</p>
          </li><li class="listitem">
            <p>In each function with a return type that is
            <code class="literal">void</code>, a return statement is implicitly assumed
            at the end of each execution path through the function
            body.</p>
          </li></ul></div>
      </div>

      <div class="section" title="Try Catch Statement"><div class="titlepage"><div><div><h4 class="title"><a name="section.try-catch"></a>Try Catch Statement</h4></div></div></div>
        

        <p>A try catch statement has the form</p><pre class="programlisting">try
   Statement<sub>1</sub>;
catch <em class="replaceable"><code>PatternWithAction</code></em><sub>1</sub>;
catch <em class="replaceable"><code>PatternWithAction</code></em><sub>2</sub>;
...
catch: <em class="replaceable"><code>Statement</code></em><sub>2</sub>;
finally: <em class="replaceable"><code>Statement</code></em><sub>3</sub>;</pre><p>and
        has as purpose to catch any exceptions that are raised during the
        execution of
        <em class="replaceable"><code>Statement</code></em><sub>1</sub>. These
        exceptions may caused by:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>The execution of an explicit throw statement, see <a class="xref" href="ch01s06.html#section.throw" title="Throw Statement">the section called &ldquo;Throw Statement&rdquo;</a>.</p>
          </li><li class="listitem">
            <p>The Rascal system that discover an abnormal condition, e.g.,
            an out of bounds error when accessing a list element.</p>
          </li></ul></div>

        <p>Note that all elements of the try catch statement are optional
        but that at least one has to be present. Their meaning is as
        follows:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>If a pattern of some
            <em class="replaceable"><code>PatternWithAction</code></em><sub>i</sub>
            matches, the corresponding action is executed.</p>
          </li><li class="listitem">
            <p>Otherwise,
            <em class="replaceable"><code>Statement</code></em><sub>2</sub> is
            executed (when present).</p>
          </li><li class="listitem">
            <p>Before leaving the try catch statement
            <em class="replaceable"><code>Statement</code></em><sub>3</sub> is
            always executed (when present).</p>
          </li></ul></div>
      </div>

      <div class="section" title="Throw Statement"><div class="titlepage"><div><div><h4 class="title"><a name="section.throw"></a>Throw Statement</h4></div></div></div>
        

        <p>A throw statement has the form</p><pre class="programlisting"><span class="keysym">throw</span> <em class="replaceable"><code>Exp</code></em>;</pre><p>and
        causes the immediate abortion of the execution of the current function
        with <em class="replaceable"><code>Exp</code></em>'s value as exception value. The
        exception can be caught by a try catch statement (<a class="xref" href="ch01s06.html#section.try-catch" title="Try Catch Statement">the section called &ldquo;Try Catch Statement&rdquo;</a>) in the current function or in one of
        its callers. If the exception is not caught, the execution of the
        Rascal program is terminated. The following rules apply:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>The static type of <em class="replaceable"><code>Exp</code></em> should be
            <code class="literal">RuntimeException</code>, see <a class="xref" href="ch01s07.html#section.lib-Exception" title="Exception">the section called &ldquo;Exception&rdquo;</a>.</p>
          </li><li class="listitem">
            <p>The Rascal program may contain data declarations that extend
            the type RuntimeException.</p>
          </li></ul></div>
      </div>

      <div class="section" title="Assert Statement"><div class="titlepage"><div><div><h4 class="title"><a name="N2300D"></a>Assert Statement</h4></div></div></div>
        

        <p>An assert statement may occur everywhere where a declaration is
        allowed. It has two forms:</p>

        <pre class="programlisting"><span class="keysym">assert</span> <code class="literal"><em class="replaceable"><code>Exp</code></em><sub>1</sub></code></pre>

        <p>and </p><pre class="programlisting"><span class="keysym">assert</span><code class="literal"> <em class="replaceable"><code>Exp</code></em><sub>1</sub> : <em class="replaceable"><code>Exp</code></em><sub>2</sub></code></pre><p>where
        <em class="replaceable"><code>Exp</code></em><sub>1</sub> is a
        boolean-value expression and
        <em class="replaceable"><code>Exp</code></em><sub>2</sub> is a
        string-valued expression that serves as a identifying message for this
        assertion. During execution, a list of true and false assertions is
        maintained. When the script is executed as a <span class="emphasis"><em>test
        suite</em></span> a summary of this information is shown to the user.
        When the script is executed in the standard fashion, the assert
        statement has no affect. </p><div class="caution" title="Caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3>
            <p>Update the above description.</p>
          </div>

        <p>Example:</p>

        <pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>assert {1, 2, 3, 1} == {3, 2, 1, 1} : "Equality on Sets";</code></strong>
bool: true</pre>
      </div>

      <div class="section" title="Insert Statement"><div class="titlepage"><div><div><h4 class="title"><a name="section.insert"></a>Insert Statement</h4></div></div></div>
        

        <p>An insert statement has the form</p><pre class="programlisting"><span class="keysym">insert</span> <em class="replaceable"><code>Exp</code></em>;</pre><p>and
        replaces the value of the <span class="emphasis"><em>current subject</em></span> (see
        below) by the value of <em class="replaceable"><code>Exp</code></em>. An insert
        statement may only occur in the action part of a PatternWithAction
        (see <a class="xref" href="ch01s06.html#section.pattern-with-action" title="PatternWithAction">the section called &ldquo;PatternWithAction&rdquo;</a>), more precisely
        in</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>A case in a visit expression, see <a class="xref" href="ch01s06.html#section.visit" title="Visit expression">the section called &ldquo;Visit expression&rdquo;</a>. The current subject is the value
            matched by the pattern of this case.</p>
          </li><li class="listitem">
            <p>An action of a rewrite rule, see <a class="xref" href="ch01s06.html#section.rewrite-rule" title="Rewrite Rule Declaration">the section called &ldquo;Rewrite Rule Declaration&rdquo;</a>. The current subject is the
            value matched by the pattern of the rewrite rule.</p>
          </li></ul></div>

        <p>The following rule applies:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>The static type of Exp and of the current subject should be
            comparable.</p>
          </li></ul></div>
      </div>

      <div class="section" title="Fail Statement"><div class="titlepage"><div><div><h4 class="title"><a name="section.fail"></a>Fail Statement</h4></div></div></div>
        

        <p>A fail statement has the form</p><pre class="programlisting"><span class="keysym">fail</span>;</pre>

        <p>and may only occur in the action of PatternWithAction (see <a class="xref" href="ch01s06.html#section.pattern-with-action" title="PatternWithAction">the section called &ldquo;PatternWithAction&rdquo;</a>). The fail statement forces
        the failure of that action. Any bindings caused by the pattern or
        side-effects caused by the action are undone.</p>
      </div>

      <div class="section" title="Block Statement"><div class="titlepage"><div><div><h4 class="title"><a name="section.block"></a>Block Statement</h4></div></div></div>
        

        <p>A block consists of a sequence of statements separated by
        semi-colons:</p><pre class="programlisting"><code class="literal">{ <em class="replaceable"><code>Statement</code></em><sub>1</sub>; ... <em class="replaceable"><code>Statement</code></em><sub>n</sub> }</code></pre><p>Since
        a block is itself a statement, it may be used in all places where a
        statement is required. A block also introduces a new scope and
        variables that are declared in the block are local to that
        block.</p>
      </div>

      <div class="section" title="Solve Statement"><div class="titlepage"><div><div><h4 class="title"><a name="N230B8"></a>Solve Statement</h4></div></div></div>
        

        <p>Rascal provides a solve statement for performing arbitrary
        fixed-point computations. This means, repeating a certain computation
        as long as it causes changes. This can, for instance, be used for the
        solution of sets of simultaneous linear equations but has much wider
        applicability. The format is:</p><pre class="programlisting"><code class="literal">with {
  <em class="replaceable"><code>Type</code></em><sub>1</sub> <em class="replaceable"><code>Var</code></em><sub>1</sub> = <em class="replaceable"><code>Exp</code></em><sub>1</sub>;
  <em class="replaceable"><code>Type</code></em><sub>2</sub> <em class="replaceable"><code>Var</code></em><sub>2</sub> = <em class="replaceable"><code>Exp</code></em><sub>2</sub>;
  ...
} solve
  <em class="replaceable"><code>Statement</code></em></code></pre>

        <p>The solve statement consists of an initialization section and a
        statement. Optionally, an expression directly following the
        <code class="literal">solve</code> keyword, gives an upper bound on the number
        of iterations.</p>

        <p>In the <code class="literal">initial</code> section, the variables
        <em class="replaceable"><code>Var</code></em><sub><em class="replaceable"><code>i</code></em></sub>
        are declared and initialized. In the <code class="literal">solve</code> section,
        the statement can use and modify these variables. The statement is
        executed, assigning new values to the variables
        <em class="replaceable"><code>Var</code></em><sub><em class="replaceable"><code>i</code></em></sub>,
        and this is repeated as long as the value of any of the variables was
        changed compared to the previous repetition.</p>

        <p>Let's consider transitive closure as an example (transitive
        closure is already available as built-in operator, we use it here just
        as a simple illustration). Transitive closure of a relation is usually
        defined as:</p><pre class="programlisting">R+ = R + (R o R) + (R o R o R) + ...</pre><p>This
        can be expressed as follows:</p>

        <pre class="screen"><code class="prompt">rascal&gt;</code> <strong class="userinput"><code>rel[int,int] R = {&lt;1,2&gt;, &lt;2,3&gt;, &lt;3,4&gt;};</code></strong>
<code class="computeroutput">rel[int,int] : {&lt;1,2&gt;, &lt;2,3&gt;, &lt;3,4&gt;}</code>
<code class="prompt">rascal&gt;</code>
  <strong class="userinput"><code>with
     rel[int,int] T = R;
  solve
     T = T + (T o R);</code></strong>

<code class="computeroutput">rel[int,int] : {&lt;1,2&gt;, &lt;1,3&gt;,&lt;1,4&gt;,&lt;2,3&gt;,&lt;2,4&gt;,&lt;3,4&gt;}</code></pre>
      </div>
    </div>
  </div><div class="navfooter"><hr><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="ch01s05.html">Prev</a>&nbsp;</td><td align="center" width="20%">&nbsp;</td><td align="right" width="40%">&nbsp;<a accesskey="n" href="ch01s07.html">Next</a></td></tr><tr><td valign="top" align="left" width="40%">Larger Examples&nbsp;</td><td align="center" width="20%"><a accesskey="h" href="index.html">Home</a></td><td valign="top" align="right" width="40%">&nbsp;Built-in Operators and Library Functions</td></tr></table></div></body></html>